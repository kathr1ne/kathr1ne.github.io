<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>DjangoRESTframework | Kathr1neMinho</title><meta name="keywords" content="Python,Web,前后端分离,RESTful,API"><meta name="author" content="Kathr1neMinho"><meta name="copyright" content="Kathr1neMinho"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="RESTFrameworkRESTful API 设计指南 DjangoRESTframework官网 DjangoRESTframework 中文教程 RESTful APIAPI接口： 通过网络 规定了前后台信息交互规则的url链接 也就是前后台信息交互的媒介 简介123456REST 全称：Representational State Transfer 中文意思的表述(通常译为：表征性状态转">
<meta property="og:type" content="article">
<meta property="og:title" content="DjangoRESTframework">
<meta property="og:url" content="https://github.com/kathr1ne/2021/02/22/DjangoRestFramework/index.html">
<meta property="og:site_name" content="Kathr1neMinho">
<meta property="og:description" content="RESTFrameworkRESTful API 设计指南 DjangoRESTframework官网 DjangoRESTframework 中文教程 RESTful APIAPI接口： 通过网络 规定了前后台信息交互规则的url链接 也就是前后台信息交互的媒介 简介123456REST 全称：Representational State Transfer 中文意思的表述(通常译为：表征性状态转">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-02-22T15:00:00.000Z">
<meta property="article:modified_time" content="2021-02-28T14:54:09.515Z">
<meta property="article:author" content="Kathr1neMinho">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="前后端分离">
<meta property="article:tag" content="RESTful">
<meta property="article:tag" content="API">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://github.com/kathr1ne/2021/02/22/DjangoRestFramework/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-02-28 22:54:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.JPG" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kathr1neMinho</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">DjangoRESTframework</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-02-22T15:00:00.000Z" title="发表于 2021-02-22 23:00:00">2021-02-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-02-28T14:54:09.515Z" title="更新于 2021-02-28 22:54:09">2021-02-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/PYTHON/">PYTHON</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="RESTFramework"><a href="#RESTFramework" class="headerlink" title="RESTFramework"></a>RESTFramework</h1><p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html">RESTful API 设计指南</a></p>
<p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/">DjangoRESTframework官网</a></p>
<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/lxraw/">DjangoRESTframework 中文教程</a></p>
<h2 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h2><p>API接口： 通过网络 规定了前后台信息交互规则的url链接 也就是前后台信息交互的<strong>媒介</strong></p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REST 全称：Representational State Transfer 中文意思的表述(通常译为：表征性状态转移)</span><br><span class="line"></span><br><span class="line">RESTful是一种定义Web API接口的设计风格 尤其适用于前后端分离的应用模式中</span><br><span class="line">这种风格的理念认为：后端开发任务就是提供数据的 对外提供的是数据资源的访问接口 所以在定义接口时 客户端访问的URL路径就表示这种要操作的数据资源</span><br><span class="line"></span><br><span class="line">事实上 我们可以使用任何一个框架都可以实现符合restful规范的接口</span><br></pre></td></tr></table></figure>
<h3 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h3><p><strong><em>Restful 10条规范</em></strong></p>
<ol>
<li><strong>协议</strong></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL链接一般都采用https协议进行传输 注：采用https协议 可以提高数据交互过程中的安全性</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p><strong>接口特征性表现(一看就知道是API接口)</strong></p>
<p>用api关键字表示接口url</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- https://api.example.com</span><br><span class="line">- https://example.org/api/      </span><br><span class="line"><span class="comment"># 如果确定API很简单 不会有进一步扩展 可以考虑放在主域名之下</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p><strong>多版本共存</strong></p>
<p>应该将API的版本放入URL(一种资源有多版本请况下)</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- https://api.example.com/v1/</span><br><span class="line">- https://api.example.com/v2/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 另一种做法是 将版本号放在HTTP头信息中 但不如放入URL方便和直观</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li><p><strong>数据即是资源 均使用名字(复数) - 重要</strong></p>
<p>接口一般都是完成前后台数据的交互 交互的数据我们称之为资源</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- https://api.example.com/v1/zoos</span><br><span class="line">- https://api.example.com/v1/animals</span><br><span class="line">- https://api.example.com/v1/employees</span><br><span class="line">    </span><br><span class="line">注：一般提倡用资源的复数形式 在URL链接中不要出现操作资源的动词</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 特殊的接口可以出现动词 因为这些接口一般没有一个明确的资源 或是动词就是接口的核心含义</span></span><br><span class="line">  - https://api.baidu.com/place/search</span><br><span class="line">  - https://api.baidu.com/login</span><br></pre></td></tr></table></figure>
<ol start="5">
<li><p><strong>资源操作由请求方式决定(method) - 重要</strong></p>
<p>操作资源一般都会设计到增删改查 我们提供请求方式来标识这些动作</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- https://api.baidu.com/books  - GET请求：获取所有书</span><br><span class="line">- https://api.baidu.com/books/<span class="number">1</span>  GET请求：获取主键为<span class="number">1</span>的书</span><br><span class="line">- https://api.baidu.com/books    POST请求：新增一本书</span><br><span class="line">- https://api.baidu.com/books/<span class="number">1</span>  PUT请求：整体修改主键为<span class="number">1</span>的书</span><br><span class="line">- https://api.baidu.com/books/<span class="number">1</span>  PATCH请求：局部修改主键为<span class="number">1</span>的书</span><br><span class="line">- https://api.baidu.com/books    DELETE请求：删除主键为<span class="number">1</span>的书</span><br></pre></td></tr></table></figure>
<p>   常用的HTTP动词有下面五个(括号里面是对应的SQL命令)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- GET(SELECT):    从服务器取出资源(一项或多项资源)</span><br><span class="line">- POST(CREATE):   在服务器新建一个资源</span><br><span class="line">- PUT(UPDATE):    在服务器更新资源(客户端提供改变后的完整资源)</span><br><span class="line">- PATCH(UPDATE):  在服务器更新资源(客户端提供改变的属性)</span><br><span class="line">- DELETE(DELETE): 从服务器删除资源</span><br></pre></td></tr></table></figure>
<p>   还有两个不常用的HTTP动词</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- HEAD: 获取资源的元数据</span><br><span class="line">- OPTIONS: 获取信息 关于资源的哪些属性是客户端可以改变的</span><br></pre></td></tr></table></figure>
<ol start="6">
<li><strong>过滤信息</strong></li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果记录数量很多 服务器不可能都将它们返回给用户</span></span><br><span class="line"><span class="comment"># API应该提供参数 过滤返回结果</span></span><br><span class="line">  - ?limit=10   指定返回记录的数量</span><br><span class="line">  - ?offset=10  指定返回记录的开始位置</span><br><span class="line">  - ?page=2&amp;per_page=100  指定第几页，以及每页的记录数</span><br><span class="line">  - ?sortby=name&amp;order=asc  指定返回结果按照哪个属性排序，以及排序顺序</span><br><span class="line">  - ?animal_type_id=1  指定筛选条件</span><br></pre></td></tr></table></figure>
<ol start="7">
<li><p><strong>状态码</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">状态码完全列表</a></p>
<p>服务器向用户返回的状态码和提示信息</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常见的有以下一些(方括号中是该状态码对应的HTTP动词)</span></span><br><span class="line"><span class="number">200</span> OK - [GET]：服务器成功返回用户请求的数据 该操作是幂等的（Idempotent）</span><br><span class="line"><span class="number">201</span> CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功</span><br><span class="line"><span class="number">202</span> Accepted - [*]：表示一个请求已经进入后台排队（异步任务）</span><br><span class="line"><span class="number">204</span> NO CONTENT - [DELETE]：用户删除数据成功</span><br><span class="line"></span><br><span class="line"><span class="number">301</span> Moved Permanently 永久重定向</span><br><span class="line"><span class="number">302</span> Found 暂时重定向</span><br><span class="line"></span><br><span class="line"><span class="number">400</span> INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误 服务器没有进行新建或修改数据的操作 该操作是幂等的</span><br><span class="line"><span class="number">401</span> Unauthorized - [*]：表示用户没有权限(令牌、用户名、密码错误)</span><br><span class="line"><span class="number">403</span> Forbidden - [*] 表示用户得到授权(与<span class="number">401</span>错误相对) 但是访问是被禁止的</span><br><span class="line"><span class="number">404</span> NOT FOUND - [*]：用户发出的请求针对的是不存在的记录 服务器没有进行操作 该操作是幂等的</span><br><span class="line"><span class="number">406</span> Not Acceptable - [GET]：用户请求的格式不可(比如用户请求JSON格式 但是只有XML格式)</span><br><span class="line"><span class="number">410</span> Gone -[GET]：用户请求的资源被永久删除 且不会再得到的</span><br><span class="line"><span class="number">422</span> Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时 发生一个验证错误</span><br><span class="line"></span><br><span class="line"><span class="number">500</span> INTERNAL SERVER ERROR - [*]：服务器发生错误 用户将无法判断发出的请求是否成功</span><br></pre></td></tr></table></figure>
<ol start="8">
<li><strong>错误处理</strong></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果状态码是4xx 就应该向用户返回出错信息</span></span><br><span class="line"><span class="comment"># 一般来说 返回的信息中将error作为键名 出错信息作为键值即可</span></span><br><span class="line">&#123;</span><br><span class="line">    error: <span class="string">&quot;Invalid API key&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="9">
<li><p><strong>返回结果</strong></p>
<p>针对不同操作 服务器向用户返回的结果应该符合以下规范</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET    /collection： 返回资源对象的列表(数组)</span><br><span class="line">GET    /collection/resource： 返回单个资源对象</span><br><span class="line">POST   /collection： 返回新生成的资源对象</span><br><span class="line">PUT    /collection/resource： 返回完整的资源对象</span><br><span class="line">PATCH  /collection/resource： 返回完整的资源对象</span><br><span class="line">DELETE /collection/resource： 返回一个空文档</span><br></pre></td></tr></table></figure>
<ol start="10">
<li><strong>Hypermedia API</strong></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RESTful API最好做到Hypermedia </span><br><span class="line">即返回结果中提供链接 连向其他API方法 使得用户不查文档 也知道下一步应该做什么</span><br><span class="line"></span><br><span class="line">Hypermedia API的设计被称为HATEOAS</span><br><span class="line">Github的API就是这种设计 访问api.github.com会得到一个所有可用API的网址列表</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;current_user_url&quot;</span>: <span class="string">&quot;https://api.github.com/user&quot;</span>,</span><br><span class="line">  <span class="string">&quot;authorizations_url&quot;</span>: <span class="string">&quot;https://api.github.com/authorizations&quot;</span>,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>其他</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> API的身份认证应该使用OAuth <span class="number">2.0</span>框架</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 服务器返回的数据格式 应该尽量使用JSON 避免使用XML</span><br></pre></td></tr></table></figure>
<h1 id="DRF初识"><a href="#DRF初识" class="headerlink" title="DRF初识"></a>DRF初识</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework==<span class="number">3.12</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 在settings.py注册app</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">     ...</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 在models.py中写表模型</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    author = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    </span><br><span class="line"><span class="number">3.</span> 新建一个序列化类</span><br><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> ModelSerializer</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookModelSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Book</span><br><span class="line">        fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="number">4.</span> 在视图中写视图类(CBV)</span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .serializer <span class="keyword">import</span> BookModelSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookModelSerializer</span><br><span class="line">    </span><br><span class="line"><span class="number">5.</span> 写路由关系</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> .book <span class="keyword">import</span> views</span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line"></span><br><span class="line">router = DefaultRouter()</span><br><span class="line">router.register(<span class="string">&#x27;books&#x27;</span>, views.BooksViewSet)</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns += router.urls</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">DRF通过上面几步很少的代码 就已经实现了/books/的5个接口：</span></span><br><span class="line"><span class="string">127.0.0.1:8000/books/    GET    获取所有书籍</span></span><br><span class="line"><span class="string">127.0.0.1:8000/books/    POST   新增书籍</span></span><br><span class="line"><span class="string">127.0.0.1:8000/books/2/  GET    获取主键为2的书籍详情</span></span><br><span class="line"><span class="string">127.0.0.1:8000/books/2/  DELETE 删除主键为2的书籍</span></span><br><span class="line"><span class="string">127.0.0.1:8000/books/2/  PUT    修改主键为2的书籍详情</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="CBV源码"><a href="#CBV源码" class="headerlink" title="CBV源码"></a>CBV源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ModelViewSet继承自View(django远程的View)</span></span><br><span class="line"><span class="comment"># ModelViewSet -&gt; APIView -&gt; View</span></span><br></pre></td></tr></table></figure>
<h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><ul>
<li><strong>CBV简单实现</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, views.Books.as_view()),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;c++&#x27;</span>: <span class="number">111</span>&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">127.0.0.1:8000/books/  GET  通过CBV实现GET请求方法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>as_view()</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">源码解读：切入口：as_view()</span></span><br><span class="line"><span class="string">本质还是FBV: </span></span><br><span class="line"><span class="string">    views.Books.as_view() -&gt;  as_view()返回一个函数对象 -&gt; views.Books.view</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">如果请求过来 路径匹配上 会执行 views.Books.view的 view内存地址指向的函数对象 并把request参数传入(当次请求的request对象) -&gt; view(request) </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># as_view()本质</span></span><br><span class="line"><span class="meta">@classonlymethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">as_view</span>(<span class="params">cls, **initkwargs</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">view</span>(<span class="params">request, *args, **kwargs</span>):</span></span><br><span class="line">        self = cls(**initkwargs)</span><br><span class="line">        <span class="comment"># cls是我们自己写的类 调用的时候自动注入(谁调用 注入谁)</span></span><br><span class="line">        <span class="comment"># self = LoginView(**initkwargs) 产生一个我们自己写的类的实例</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;get&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;head&#x27;</span>):</span><br><span class="line">            self.head = self.get</span><br><span class="line">        self.request = request</span><br><span class="line">        self.args = args</span><br><span class="line">        self.kwargs = kwargs</span><br><span class="line">        <span class="keyword">return</span> self.dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        以后 经常会需要看源码 但是在看Python源码的时候 一定要时刻提醒自己 面向对象属性方法查找顺序 mro</span></span><br><span class="line"><span class="string">        总结：看源码 只要看到了self.xxx 一定要问自己 当前这个self到底是谁</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> view</span><br><span class="line"></span><br><span class="line"><span class="comment"># CBV的精髓 dispath</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">    <span class="comment"># Try to dispatch to the right method; if a method doesn&#x27;t exist,</span></span><br><span class="line">    <span class="comment"># defer to the error handler. Also defer to the error handler if the</span></span><br><span class="line">    <span class="comment"># request method isn&#x27;t on the approved list.</span></span><br><span class="line">    <span class="comment"># 获取当前请求的小写格式 然后比对当前请求方式是否合法</span></span><br><span class="line">    <span class="comment"># get请求为例</span></span><br><span class="line">    <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">       <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">       反射：通过字符串来操作对象的属性或方法 运行时获取类型定义信息</span></span><br><span class="line"><span class="string">       handler = getattr(自己写的类产生的对象, &#x27;get&#x27;, 当找不到get属性或者方法的时候就会用第三个参数)</span></span><br><span class="line"><span class="string">       handler = 我们自己写的类里面的get方法</span></span><br><span class="line"><span class="string">       &quot;&quot;&quot;</span></span><br><span class="line">        handler = <span class="built_in">getattr</span>(self, request.method.lower(), self.http_method_not_allowed)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        handler = self.http_method_not_allowed</span><br><span class="line">    <span class="comment"># 自动调用get方法</span></span><br><span class="line">    <span class="keyword">return</span> handler(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="APIView"><a href="#APIView" class="headerlink" title="APIView"></a>APIView</h3><ul>
<li><strong>CBV简单实现</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"><span class="comment"># 也是as_view() 只不过被APIView(继承View)重写</span></span><br><span class="line">path(<span class="string">&#x27;books_apiview/&#x27;</span>, views.BooksAPIView.as_view())</span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;APIView&#x27;</span>: <span class="number">666</span>&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>as_view()</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">源码解读：切入口还是 as_view() -&gt; APIView的as_view() -&gt; view 函数内存地址</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">@classmethod  </span><span class="comment"># 类的绑定方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">as_view</span>(<span class="params">cls, **initkwargs</span>):</span></span><br><span class="line">    view = <span class="built_in">super</span>().as_view(**initkwargs)  <span class="comment"># 调用父类的as_view方法</span></span><br><span class="line">    view.cls = cls</span><br><span class="line">    view.initkwargs = initkwargs</span><br><span class="line">    <span class="comment"># 继承APIView的视图类会禁用csrf认证(drf会有自己的认证)</span></span><br><span class="line">    <span class="comment"># 添加装饰器的另一种方法 @方式是语法糖 本质就是传入一个被装饰函数给装饰器函数当作实参</span></span><br><span class="line">    <span class="keyword">return</span> csrf_exempt(view)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用csrf装饰器 URL视图还可以这么写 </span></span><br><span class="line">path(<span class="string">&#x27;test/&#x27;</span>, csrf_exempt(as_view))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">发起请求 -&gt; 路由匹配成功 -&gt; view(request) -&gt; 调用dispath() -&gt; mro属性查找顺序 self.dispath会执行到APIView的dispath方法 而不再走View类的dispath -&gt; 把请求方法转为小写 -&gt; 通过反射去对象中查找 有没有改方法定义的属性 有则传入request并执行</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># APIView的disapth</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">    self.args = args</span><br><span class="line">    self.kwargs = kwargs</span><br><span class="line">    <span class="comment"># request参数是当次请求的request对象</span></span><br><span class="line">    <span class="comment"># 请求过来 wsgi注入一个envrion字段 django把它包装成一个request对象</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 然后重新赋值的request 是初始化处理后的一个新的Request对象</span></span><br><span class="line">    request = self.initialize_request(request, *args, **kwargs)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 现在视图函数拿到的request 已经不是django原生给我们封装的request</span></span><br><span class="line">    <span class="comment"># 而是drf自己定义的request对象(mro) 以后视图函数再使用的request对象 就是这个新的drf定义的对象</span></span><br><span class="line">    self.request = request  <span class="comment"># 将新的request对象赋值给self.request 你视图函数里面 其他的方法 也可以从这个里面获取相关数据</span></span><br><span class="line">    self.headers = self.default_response_headers  <span class="comment"># deprecate?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 三大认证模块</span></span><br><span class="line">        self.initial(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get the appropriate handler method</span></span><br><span class="line">        <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">            handler = <span class="built_in">getattr</span>(self, request.method.lower(),</span><br><span class="line">                              self.http_method_not_allowed)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            handler = self.http_method_not_allowed</span><br><span class="line">		 <span class="comment"># 响应模块</span></span><br><span class="line">        response = handler(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> exc:</span><br><span class="line">       <span class="comment"># 异常模块</span></span><br><span class="line">        response = self.handle_exception(exc)</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 渲染模块</span></span><br><span class="line">    self.response = self.finalize_response(request, response, *args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> self.response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装drf自己的request对象</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize_request</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">    parser_context = self.get_parser_context(request)</span><br><span class="line">    <span class="comment"># django原来的request 被封装到Request里面 </span></span><br><span class="line">    <span class="comment"># self._request 原生的request</span></span><br><span class="line">    <span class="comment"># self.request  drf封装的request</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回DRF封装的Request类实例化之后的对象</span></span><br><span class="line">    <span class="keyword">return</span> Request(</span><br><span class="line">        request,    <span class="comment"># 原生的request对象</span></span><br><span class="line">        <span class="comment"># 获取解析类</span></span><br><span class="line">        parsers=self.get_parsers(),</span><br><span class="line">        authenticators=self.get_authenticators(),</span><br><span class="line">        negotiator=self.get_content_negotiator(),</span><br><span class="line">        parser_context=parser_context</span><br><span class="line">    ) </span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">针对这个赋值：</span></span><br><span class="line"><span class="string">self.request = request  # 将新的request对象赋值给self.request 你视图函数里面 其他的方法 也可以从这个里面获取相关数据(就是drf封装的当次请求的request)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">class MyCBV(VPIView):</span></span><br><span class="line"><span class="string">	def get(self, request):</span></span><br><span class="line"><span class="string">	    ..</span></span><br><span class="line"><span class="string">	def foo(self):</span></span><br><span class="line"><span class="string">	    print(self.request)  # 视图函数中 其他方法 不用传参 也可以直接使用该对象     </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">from rest_framework.request import Request</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">只要继承了APIView 视图类中的request对象 都是新的</span></span><br><span class="line"><span class="string">也就是上面导入路径这个Request的对象(实例)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">使用使用新的request对象 就像使用之前的request是一模一样的(因为重写了__getattr__方法)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def __getattr__(self, attr):</span></span><br><span class="line"><span class="string">    try:</span></span><br><span class="line"><span class="string">        return getattr(self._request, attr)</span></span><br><span class="line"><span class="string">    except AttributeError:</span></span><br><span class="line"><span class="string">        return self.__getattribute__(attr)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Wrapper allowing to enhance a standard `HttpRequest` instance.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Kwargs:</span></span><br><span class="line"><span class="string">        - request(HttpRequest). The original request instance.</span></span><br><span class="line"><span class="string">        - parsers(list/tuple). The parsers to use for parsing the</span></span><br><span class="line"><span class="string">          request content.</span></span><br><span class="line"><span class="string">        - authenticators(list/tuple). The authenticators used to try</span></span><br><span class="line"><span class="string">          authenticating the request&#x27;s user.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, request, parsers=<span class="literal">None</span>, authenticators=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 negotiator=<span class="literal">None</span>, parser_context=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">isinstance</span>(request, HttpRequest), (</span><br><span class="line">            <span class="string">&#x27;The `request` argument must be an instance of &#x27;</span></span><br><span class="line">            <span class="string">&#x27;`django.http.HttpRequest`, not `&#123;&#125;.&#123;&#125;`.&#x27;</span></span><br><span class="line">            .<span class="built_in">format</span>(request.__class__.__module__, request.__class__.__name__)</span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># self._request 原生的request</span></span><br><span class="line">        self._request = request</span><br><span class="line">        self._data = Empty</span><br><span class="line">		...</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># restframework封装的request对象</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">django封装的request对象没有.data &#123;&#125;</span></span><br><span class="line"><span class="string">它是一个字典 </span></span><br><span class="line"><span class="string">  - post请求不管使用什么编码(form/urlencoded/json) 传过来的数据 都在request.data</span></span><br><span class="line"><span class="string">  - get请求</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">request.data    </span><br></pre></td></tr></table></figure>
<ul>
<li><strong>取POST请求数据</strong></li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>django原生request(request.POST)</th>
<th>drf封装后的Request对象(request.data)</th>
</tr>
</thead>
<tbody><tr>
<td>form</td>
<td>有数据 QueryDict</td>
<td>有数据 QueryDict</td>
</tr>
<tr>
<td>urlencoded</td>
<td>有数据 QueryDict</td>
<td>有数据 QueryDict</td>
</tr>
<tr>
<td>json</td>
<td>无数据</td>
<td>有数据 普通字典</td>
</tr>
</tbody></table>
<ul>
<li><strong>取GET请求url中的数据</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># drf Request类方法</span></span><br><span class="line"><span class="comment"># self._request.GET = request.query_params</span></span><br><span class="line"><span class="comment"># django原来取： request.GET</span></span><br><span class="line"><span class="comment"># drf取： request.query_params</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_params</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> self._request.GET</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>APIView的initial方法</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dispath中调用 initial方法</span></span><br><span class="line"><span class="comment"># request参数 已经是新的request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initial</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">	...</span><br><span class="line">    <span class="comment"># Ensure that the incoming request is permitted</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    perform_authentication</span></span><br><span class="line"><span class="string">    认证组件：检验用户 - 游客、合法用户、非法用户</span></span><br><span class="line"><span class="string">      游客： 代表检验通过 直接进入下一步校验(权限检验)</span></span><br><span class="line"><span class="string">      合法用户：代表校验通过 将用户存储再request.user中 再进入下一步校验(权限校验)</span></span><br><span class="line"><span class="string">      非法用户：代表校验失败 抛出异常 返回403权限异常结果</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    self.perform_authentication(request)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    check_permissions</span></span><br><span class="line"><span class="string">    权限组件：校验用户权限 - 必须登录、所有用户、登录读写游客只读、自定义用户角色</span></span><br><span class="line"><span class="string">      认证通过：可以进入下一步校验(频率认证)</span></span><br><span class="line"><span class="string">      认证失败：抛出异常 返回403权限异常结构</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    self.check_permissions(request)</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    check_throttles</span></span><br><span class="line"><span class="string">    频率组件：限制视图接口被访问的频率次数 - 限制的条件(IP/id/唯一键)、频率周期时间(s/m/h)、频率的次数(3/s)</span></span><br><span class="line"><span class="string">    没有达到限制：正常访问接口</span></span><br><span class="line"><span class="string">    达到限制：限制时间之内不能访问 限制时间达到后 可以重新访问</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    self.check_throttles(request)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>补充</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于Python中一切皆对象 所以都可以设置属性 取出属性</span></span><br><span class="line"><span class="comment"># Python源码中使用非常多</span></span><br><span class="line">add.xyz = <span class="string">&#x27;xyz111&#x27;</span>  </span><br><span class="line"></span><br><span class="line">print(add(<span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">print(add.xyz)</span><br></pre></td></tr></table></figure>
<h1 id="序列化器"><a href="#序列化器" class="headerlink" title="序列化器"></a>序列化器</h1><p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/serializers/">drf-Serializer</a></p>
<p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/fields/">drf-Serializer-fileds</a></p>
<p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/relations/">drf-Serializer-relations</a></p>
<p> <strong>Serializer</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">序列化：序列化器会把模型对象转换为字典 经过response以后变成json字符串 </span></span><br><span class="line"><span class="string">       model对象 -&gt; json</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">反序列化：把客户端发送过来的数据 经过request以后变成字典(框架封装) 序列化器可以把字典转成模型</span></span><br><span class="line"><span class="string">       json -&gt; model对象</span></span><br><span class="line"><span class="string">       反序列化另一个作用：完成数据的校验功能(类似forms组件)  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> Serializer类 必须写一个类继承它 想序列化什么字段就在里面写字段(source可以修改序列化出来的字段名 获取取属性 .跨表)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 序列化queryset(列表)对象和真正(单个)的对象 many=<span class="literal">True</span>的作用 instance=要序列化的对象(模型类对象 也就是模型类实例)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 反序列化 instance=要序列化的对象 data=request.data(新增没有instance参数)</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 字段验证 序列化类中 给字段加属性(字段参数) 局部和全局钩子函数|字段参数的validaores=[] </span><br><span class="line">   视图函数中调用 序列化对象.is_valid(raise_exception=<span class="literal">True</span>)进行验证 raise_exception参数默认<span class="literal">False</span> 如果为<span class="literal">True</span> 验证不通过直接抛出异常</span><br><span class="line">    </span><br><span class="line"><span class="number">5.</span> 反序列化数据保存</span><br><span class="line">   5.1 修改保存 -&gt; 调用序列化对象的.save() -&gt; 触发序列化类的.update方法</span><br><span class="line">   5.2 新增保存 -&gt; 调用序列化对象的.save() -&gt; 触发序列化类的.create方法</span><br><span class="line"></span><br><span class="line">   备注：</span><br><span class="line">   如果自定义序列化类不是继承的ModelSerializer 需要重写 .update方法和.create方法(可以很复杂)</span><br><span class="line">   如果反序列的数据中有需要保存到第三张表的 需要在重写的方法额外处理</span><br><span class="line">    </span><br><span class="line"><span class="number">6.</span> ModelSerializer 跟Model做了对应 写法固定 字段参数直接用 extra_kwargs</span><br><span class="line">   其余用法和继承Serializer一摸一样(包括全局/局部钩子函数)</span><br><span class="line">    </span><br><span class="line"><span class="number">7.</span> many=<span class="literal">True</span> 可以序列化多条的原因</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span> 接口 鸭子类型</span><br><span class="line">           </span><br></pre></td></tr></table></figure>
<h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><h3 id="查询一个数据"><a href="#查询一个数据" class="headerlink" title="查询一个数据"></a>查询一个数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">GET 127.0.0.1:8000/books/1 获取书籍id为1的书籍信息</span></span><br><span class="line"><span class="string">  1. 写一个序列化的类 继承Serializer类</span></span><br><span class="line"><span class="string">  2. 在类中写想要序列化的字段 想序列化哪个字段 就在类中写哪个字段</span></span><br><span class="line"><span class="string">  3. 在视图类中使用 导入自定义序列化类 -&gt; 实例化得到的序列化类对象(把要序列化的对象传入)</span></span><br><span class="line"><span class="string">  4. 序列化类的对象.data 是一个字典</span></span><br><span class="line"><span class="string">  5. 把字典返回 如果不使用rest_framework提供的Response 就得使用JsonResponse</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;books/&lt;int:pk&gt;&#x27;</span>, views.BooksDetailView.as_view()),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># serializers.py</span></span><br><span class="line"><span class="comment"># from rest_framework.serializers import Serializer</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;想要序列化的字段 不需要直接注释即可&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(read_only=<span class="literal">True</span>)</span><br><span class="line">    name = serializers.CharField()</span><br><span class="line">    price = serializers.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    author = serializers.CharField()</span><br><span class="line">    publish = serializers.CharField()</span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksDetailView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="comment"># 获取数据对象</span></span><br><span class="line">        book = Book.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        <span class="comment"># 用一个类 毫无疑问：实例化 </span></span><br><span class="line">        <span class="comment"># instance参数关键字传参或者第一个位置位置传参(源码) -&gt; 序列化</span></span><br><span class="line">        serializer = BookSerializer(instance=book)</span><br><span class="line">        <span class="comment"># serializer.data -&gt; 序列化后的字典</span></span><br><span class="line">        print(serializer.data)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Response</span></span><br><span class="line"><span class="string">          使用drf Response返回 需要在settings.py注册rest_framework</span></span><br><span class="line"><span class="string">        Response会判断访问来源(user-agent) 来返回 渲染好的网页 或者是 json数据</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        JsonResponse</span></span><br><span class="line"><span class="string">          无需再注册rest_framework</span></span><br><span class="line"><span class="string">          只会返回json数据</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">        <span class="comment"># return JsonResponse(serializer.data)</span></span><br></pre></td></tr></table></figure>
<h3 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h3><p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/fields/">SerializerFields</a></p>
<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/lxraw/lxraw-u4kq35ot.html">序列化器字段</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 完整字段见上面参考链接</span></span><br><span class="line">CharField</span><br><span class="line">IntergerField</span><br><span class="line">DateField</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="字段参数"><a href="#字段参数" class="headerlink" title="字段参数"></a>字段参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检验功能 非常类似forms组件</span></span><br><span class="line">  <span class="number">1.</span> 自带字段选项校验(更多参考字段链接详细内容)</span><br><span class="line">     - read_only</span><br><span class="line">     - required  默认为<span class="literal">True</span></span><br><span class="line">     - max_length </span><br><span class="line">     - validators</span><br><span class="line">         验证器功能列表 应将其应用于输入字段输入 并引发验证错误或简单地返回</span><br><span class="line">       ...        </span><br><span class="line">  <span class="number">2.</span> 局部钩子函数</span><br><span class="line">  <span class="number">3.</span> 全局钩子函数</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 通用字段参数</span></span><br><span class="line">read_only        表明该字段仅用于序列化输出 默认<span class="literal">False</span></span><br><span class="line">write_only       表明该字段仅用于反序列化输入 默认<span class="literal">False</span></span><br><span class="line">required         表明该字段在反序列化时必须输入 默认<span class="literal">True</span></span><br><span class="line">default          反序列化时使用的默认值</span><br><span class="line">allow_null       表明该字段是否允许传入<span class="literal">None</span> 默认Flase</span><br><span class="line">validators       该字段使用的验证器</span><br><span class="line">error_messages   包含错误编号与错误信息的字典</span><br><span class="line">label            用于HTML展示API页面时 显示的字段名称</span><br><span class="line">help_text        用于HTML展示API页面时 显示的字段帮助提示信息</span><br></pre></td></tr></table></figure>
<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">PUT 127.0.0.1:8000/books/1 修改书籍主键为1的书籍信息</span></span><br><span class="line"><span class="string">  1. 写一个序列化的类 继承Serializer类</span></span><br><span class="line"><span class="string">  2. 在类中写想要反序列化的字段</span></span><br><span class="line"><span class="string">  3. 在视图类中使用 导入自定义序列化类 -&gt; 实例化得到的序列化类对象(把要修改的对象 和 修改的数据传入)</span></span><br><span class="line"><span class="string">      # instance=要修改的对象</span></span><br><span class="line"><span class="string">      # data=修改的数据</span></span><br><span class="line"><span class="string">      serializer = BookSerializer(instance=book, data=request.data)</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   4. 数据校验</span></span><br><span class="line"><span class="string">      # raise_exception参数默认为False</span></span><br><span class="line"><span class="string">      # 如果为True 验证不通过直接抛出异常</span></span><br><span class="line"><span class="string">      serializer.is_valid(raise_exception=True)</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      4.1 如果校验通过 就保存</span></span><br><span class="line"><span class="string">          serializer.save()  # 是序列化器的save()方法</span></span><br><span class="line"><span class="string">      4.2 如果校验不通过</span></span><br><span class="line"><span class="string">          返回错误信息</span></span><br><span class="line"><span class="string">          </span></span><br><span class="line"><span class="string">   5. 如果字段的校验规则不够 可以自己写钩子函数(局部和全局 类似forms)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksDetailView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        response_msg = &#123;<span class="string">&#x27;status&#x27;</span>:<span class="number">100</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;成功&#x27;</span>&#125;</span><br><span class="line">        <span class="comment"># 找到这个对象</span></span><br><span class="line">        book = Book.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        <span class="comment"># 直接用request.data的数据来修改原来的对象 -&gt; 反序列化</span></span><br><span class="line">        serializer = BookSerializer(book, request.data)</span><br><span class="line">        <span class="comment"># 一定要数据验证(类似form表单验证)</span></span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            <span class="comment"># 直接调用报错 需要重写update方法 接口规范了子类的行为 鸭子类型</span></span><br><span class="line">            <span class="comment"># NotImplementedError: `update()` must be implemented.</span></span><br><span class="line">            serializer.save()  <span class="comment"># 验证通过则返回</span></span><br><span class="line">            response_msg[<span class="string">&#x27;data&#x27;</span>] = serializer.data</span><br><span class="line">            <span class="comment"># return Response(serializer.data)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            response_msg[<span class="string">&#x27;status&#x27;</span>] = <span class="number">1001</span></span><br><span class="line">            response_msg[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;数据校验失败&#x27;</span></span><br><span class="line">            response_msg[<span class="string">&#x27;data&#x27;</span>] = serializer.errors</span><br><span class="line">        <span class="keyword">return</span> Response(response_msg)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 直接继承Serializer没有update方法 需要重写</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(read_only=<span class="literal">True</span>)</span><br><span class="line">    name = serializers.CharField(max_length=<span class="number">16</span>, min_length=<span class="number">4</span>)</span><br><span class="line">    price = serializers.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    author = serializers.CharField()</span><br><span class="line">    publish = serializers.CharField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># instance是book这个对象</span></span><br><span class="line">        <span class="comment"># validated_data是校验后的数据</span></span><br><span class="line">        instance.name = validated_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        instance.price = validated_data.get(<span class="string">&#x27;price&#x27;</span>)</span><br><span class="line">        instance.author = validated_data.get(<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">        instance.publish = validated_data.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">        instance.save()  <span class="comment"># django ORM提供的</span></span><br><span class="line">        <span class="keyword">return</span> instance</span><br></pre></td></tr></table></figure>
<h3 id="数据校验钩子函数"><a href="#数据校验钩子函数" class="headerlink" title="数据校验钩子函数"></a>数据校验钩子函数</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">先自己字段参数验证 </span><br><span class="line">-&gt; 如果该字段有局部钩子函数 走该函数验证该字段</span><br><span class="line">-&gt; 所有字段按照该顺序验证完成 看是否有全局钩子验证函数</span><br><span class="line">-&gt; 全局钩子函数验证(此时数据已经经过第一次校验 validated_data)</span><br><span class="line">-&gt; 验证完成</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>局部钩子</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_price</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        validate_字段名(通过反射获取该方法) 接收一个参数</span></span><br><span class="line"><span class="string">        :param data: 就是price 可以对任意单一字段自定义校验</span></span><br><span class="line"><span class="string">        :return: data</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># print(type(data))</span></span><br><span class="line">        <span class="keyword">if</span> data &gt; <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="comment"># 校验失败 抛出异常</span></span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;价格太低&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>输出示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">1001</span>,</span><br><span class="line">    <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;数据校验失败&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;price&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;价格太低&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>全局钩子</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        全局钩子：校验多个字段</span></span><br><span class="line"><span class="string">        :param attrs: 校验通过的数据(validated_data)</span></span><br><span class="line"><span class="string">        :return: attrs </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        print(attrs)</span><br><span class="line">        author = attrs.get(<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">        publish = attrs.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> author == publish:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;作者名字和出版社一致&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br></pre></td></tr></table></figure>
<p><strong>输出示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">1001</span>,</span><br><span class="line">    <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;数据校验失败&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;non_field_errors&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;作者名字和出版社一致&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>参数validators(非钩子函数 字段选项验证器 较少使用)</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_author</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">if</span> data.startswith(<span class="string">&#x27;sb&#x27;</span>):</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;作者名字不能以sb开头&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 使用字段参数：验证器</span></span><br><span class="line">    author = serializers.CharField(validators=[check_author])</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">加上上面的钩子函数和自带的字段验证 总共有三种验证数据的方式：</span></span><br><span class="line"><span class="string">  1. 字段参数自带的验证参数们</span></span><br><span class="line"><span class="string">  2. 局部钩子/全局钩子函数</span></span><br><span class="line"><span class="string">  3. 参数：validators 验证器</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">抛出无效数据的异常</span></span><br><span class="line"><span class="string">  .is_valid()方法使用可选的raise_exception标志 如果存在验证错误将会抛出一个serializers.ValidationError异常</span></span><br><span class="line"><span class="string">  这些异常由REST framework提供的默认异常处理程序自动处理 </span></span><br><span class="line"><span class="string">  默认情况下将返回HTTP 400 Bad Request响应</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果数据无效就返回400响应</span></span><br><span class="line">serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p><strong>输出示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;数据校验失败&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;author&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;作者名字不能以sb开头&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="序列化反序列化字段处理"><a href="#序列化反序列化字段处理" class="headerlink" title="序列化反序列化字段处理"></a>序列化反序列化字段处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">问题：我们序列化的时候和反序列化的时候 使用的字段数目不全部一致</span></span><br><span class="line"><span class="string">     比如主键id 序列化展示 反序列化不应该输入</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">解决：</span></span><br><span class="line"><span class="string">  1. 写两个serializer类 一个用于序列化 一个用于反序列化 -&gt; 冗余度非常高 麻烦</span></span><br><span class="line"><span class="string">  2. 字段参数解决</span></span><br><span class="line"><span class="string">      read_only    表明该字段仅用于序列化输出 默认False</span></span><br><span class="line"><span class="string">      write_only   表名该字段仅用于反序列化输入 默认False</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    read_only=True</span></span><br><span class="line"><span class="string">      - 序列化输出 有该字段</span></span><br><span class="line"><span class="string">      - 反序列化传入数据 不需要传该字段 错误的输入所有的read_only字段都将被忽略</span></span><br><span class="line"><span class="string">    write_only</span></span><br><span class="line"><span class="string">      - 序列化输出 没有该字段</span></span><br><span class="line"><span class="string">      - 反序列化传入数据 必须传入该字段 否则校验失败</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(read_only=<span class="literal">True</span>)</span><br><span class="line">    publish = serializers.CharField(max_length=<span class="number">64</span>, min_length=<span class="number">2</span>, write_only=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h2 id="其余API操作"><a href="#其余API操作" class="headerlink" title="其余API操作"></a>其余API操作</h2><h3 id="查询所有数据"><a href="#查询所有数据" class="headerlink" title="查询所有数据"></a>查询所有数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line">path(<span class="string">&#x27;books/&#x27;</span>, views.Books.as_view())</span><br><span class="line"></span><br><span class="line"><span class="comment"># View</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 序列化多条 需要加参数：many=True</span></span><br><span class="line">        serializer = BookModelSerializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>
<h3 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line">path(<span class="string">&#x27;books/&#x27;</span>, views.Books.as_view())</span><br><span class="line"></span><br><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, repost</span>):</span></span><br><span class="line">        <span class="comment"># 修改才有instance 新增没有instance 只有data</span></span><br><span class="line">        <span class="comment"># 必须关键字传参 位置传参会给到第一个位置参数:instance</span></span><br><span class="line">        book_ser = BookModelSerializer(data=repost.data)</span><br><span class="line">        <span class="comment"># 校验字段</span></span><br><span class="line">        <span class="keyword">if</span> book_ser.is_valid():</span><br><span class="line">            book_ser.save()</span><br><span class="line">            <span class="keyword">return</span> Response(book_ser.data)</span><br><span class="line">        <span class="keyword">return</span> Response(book_ser.errors)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># serializers.py 需要重写create()方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param validated_data: dict正好可以**解构</span></span><br><span class="line"><span class="string">        :return: </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 如果validated_data的数据 不是全部需要 </span></span><br><span class="line">        <span class="comment"># 就需要拿出来额外处理 不能直接双**解构</span></span><br><span class="line">        <span class="keyword">return</span> Book.objects.create(**validated_data)</span><br></pre></td></tr></table></figure>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除无需序列化器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksDetail</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;删除一个数据&quot;&quot;&quot;</span></span><br><span class="line">        Book.objects.<span class="built_in">filter</span>(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br></pre></td></tr></table></figure>
<h2 id="自定义响应内容"><a href="#自定义响应内容" class="headerlink" title="自定义响应内容"></a>自定义响应内容</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># utils.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResponse</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.status = <span class="number">100</span></span><br><span class="line">        self.mgs = <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__dict__</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用的时候 实例化再修改属性即可</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    res = MyResponse()</span><br><span class="line">    res.status = <span class="number">101</span></span><br><span class="line">    res.msg = <span class="string">&#x27;数据校验失败&#x27;</span></span><br><span class="line">    res.data = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Minho&#x27;</span>&#125;</span><br><span class="line">    print(res.get_dict)</span><br></pre></td></tr></table></figure>
<h2 id="模型类序列化器"><a href="#模型类序列化器" class="headerlink" title="模型类序列化器"></a>模型类序列化器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookModelSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="comment"># ModelSerializer 也可以使用source参数 用法一样</span></span><br><span class="line">    pce = serializers.CharField(source=<span class="string">&#x27;publish.price&#x27;</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Book                  <span class="comment"># 对应models.py中的表模型(要序列化哪个表的数据)</span></span><br><span class="line">        <span class="comment"># fields = &#x27;__all__&#x27;          # __all__标识序列化所有字段</span></span><br><span class="line">        <span class="comment"># fields = [&#x27;name&#x27;, &#x27;price&#x27;]  # 只序列化指定字段</span></span><br><span class="line">        exclude = [<span class="string">&#x27;name&#x27;</span>]            <span class="comment"># 跟fields不能都写 写哪个字段标识排除哪个字段</span></span><br><span class="line">        read_only_fields = [<span class="string">&#x27;price&#x27;</span>]</span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span>: &#123;<span class="string">&#x27;write_only&#x27;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">write_only_fields 弃用 -&gt; 使用extra_kwargs解决</span></span><br><span class="line"><span class="string">  可以通过使用extra_kwargs选项快捷地在字段上指定任意附加的关键字参数</span></span><br><span class="line"><span class="string">  类似于：Serializer的 name = serializers.CharField(max_length=16, min_length=4)</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">示例：</span></span><br><span class="line"><span class="string">  extra_kwargs = &#123;&#x27;password&#x27;: &#123;&#x27;write_only&#x27;: True&#125;,</span></span><br><span class="line"><span class="string">                  &#x27;author&#x27;: &#123;&#x27;write_only&#x27;: True&#125;,&#125;</span></span><br><span class="line"><span class="string">                  </span></span><br><span class="line"><span class="string">备注：</span></span><br><span class="line"><span class="string">  继承ModelSerializer之后 不用再自己重写 .update() 和 .create()方法</span></span><br><span class="line"><span class="string">  其他使用方式和继承Serializer 一摸一样</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>        </span><br></pre></td></tr></table></figure>
<p><strong>输出示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;nid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;pce&quot;</span>: <span class="string">&quot;129.11&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;红楼梦&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;price&quot;</span>: <span class="string">&quot;129.11&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;publish&quot;</span>: <span class="string">&quot;北京出版社&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;nid&quot;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">&quot;pce&quot;</span>: <span class="string">&quot;192.45&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;python&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;price&quot;</span>: <span class="string">&quot;192.45&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;publish&quot;</span>: <span class="string">&quot;xx出版社&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="many-True源码分析"><a href="#many-True源码分析" class="headerlink" title="many=True源码分析"></a>many=True源码分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化多条数据的时候 需要传 many=True</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># 序列化单条</span></span><br><span class="line">        book = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        books_one_ser = BookModelSerializer(instance=book)</span><br><span class="line">        <span class="comment"># 序列化多条</span></span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        books_ser = BookModelSerializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        print(<span class="built_in">type</span>(books_one_ser))</span><br><span class="line">        print(<span class="built_in">type</span>(books_ser))</span><br><span class="line">        <span class="keyword">return</span> Response(books_ser.data)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># many=True时 返回的结果跟不传 不是同一个类的对象</span></span><br><span class="line">单条类型： &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">drftutorial</span>.<span class="title">book</span>.<span class="title">serializer</span>.<span class="title">BookModelSerializer</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">多条类型： &lt;<span class="title">class</span> &#x27;<span class="title">rest_framework</span>.<span class="title">serializers</span>.<span class="title">ListSerializer</span>&#x27;&gt; </span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class">对象的生成：先调用类的<span class="title">__new__</span>方法 生成空对象</span></span><br><span class="line"><span class="class">实例化：类名(<span class="params">参数</span>) 调用类的<span class="title">__init__</span>()方法</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">类的<span class="title">__new__</span>方法 控制对象的生成 -&gt; 由此猜测BookModelSerializer类的__new__方法做了处理 根据是否有many=True参数 生成不同的类对象</span></span><br><span class="line"><span class="class">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class">class BaseSerializer(Field):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># We override this method in order to automatically create</span></span><br><span class="line">        <span class="comment"># `ListSerializer` classes instead when `many=True` is set.</span></span><br><span class="line">        <span class="keyword">if</span> kwargs.pop(<span class="string">&#x27;many&#x27;</span>, <span class="literal">False</span>):</span><br><span class="line">            <span class="keyword">return</span> cls.many_init(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 没有传many=True 正常实例化</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__new__(cls, *args, **kwargs)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">many_init</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">		...</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        如果传入many=True 调用该方法 生成新得类对象 里面就是一个个得Serializer对象</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> list_serializer_class(*args, **list_kwargs)</span><br></pre></td></tr></table></figure>
<h2 id="Serializer高级用法"><a href="#Serializer高级用法" class="headerlink" title="Serializer高级用法"></a>Serializer高级用法</h2><p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/relations/">关联字段</a></p>
<h3 id="一对多关系字段"><a href="#一对多关系字段" class="headerlink" title="一对多关系字段"></a>一对多关系字段</h3><ul>
<li><strong>source参数</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">source参数就是指定序列化对象的属性</span><br><span class="line">该属性可以是模型类的字段属性</span><br><span class="line">也可以是该模型类的方法(类方法本质也是类属性 本质一样）</span><br><span class="line">            </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">source的使用 下面三个功能：</span></span><br><span class="line"><span class="string">  1. 可以改字段名字  xxx = serializers.CharField(max_length=32, source=&#x27;title&#x27;)</span></span><br><span class="line"><span class="string">  2. 可以.跨表取属性 publish = serializers.CharField(source=&#x27;publish.email&#x27;)</span></span><br><span class="line"><span class="string">  3. 可以执行方法 publish_date = serializers.DateTimeField(source=&#x27;test&#x27;)  # test不是model类对应字段 而是自定义函数</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>source=对象属性</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">一对多关系字段：</span></span><br><span class="line"><span class="string">  1. 模型类__str__魔术方法</span></span><br><span class="line"><span class="string">     publish = serializers.CharField() -&gt; book.publish -&gt; 获取publish的__str__方法返回值</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  2. source参数用法</span></span><br><span class="line"><span class="string">     publish = serializers.CharField(source=&#x27;publish.email&#x27;)</span></span><br><span class="line"><span class="string">     source参数可以直接取模型类的字段</span></span><br><span class="line"><span class="string">       2.1 更换序列化器显示的字段名称(隐藏真正的数据库字段) 用source与实际的数据库模块字段对应 </span></span><br><span class="line"><span class="string">       xxx = serializers.CharField(max_length=32, source=&#x27;title&#x27;)       </span></span><br><span class="line"><span class="string">       2.2 一对多关系中 可以取到关联关系表中的其他字段(跨表)</span></span><br><span class="line"><span class="string">       publish = serializers.CharField(source=&#x27;publish.email&#x27;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="comment"># 这部分字段相当于隐藏了模型前缀 相当于取book得属性(包括方法)</span></span><br><span class="line">    <span class="comment"># book.xxx | book.price | book.publish_data...</span></span><br><span class="line">    xxx = serializers.CharField(max_length=<span class="number">32</span>, source=<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">    price = serializers.DecimalField(max_digits=<span class="number">8</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    publish_date = serializers.DateTimeField()</span><br><span class="line">    <span class="comment"># book.publish 外键关联字段 直接写 显示结果会显示__str__方法的结果</span></span><br><span class="line">    publish = serializers.CharField(source=<span class="string">&#x27;publish.email&#x27;</span>)</span><br><span class="line">    <span class="comment"># book.authors None -&gt; book.authors.all()   </span></span><br></pre></td></tr></table></figure>
<p><strong>source=对象方法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># serializers.py</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    xxx = serializers.CharField(max_length=<span class="number">32</span>, source=<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">    publish_date = serializers.DateTimeField(source=<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;book.test method&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">source指定的方法的return内容就是序列化的内容</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>输出示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;xxx&quot;</span>: <span class="string">&quot;红楼梦&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;publish_date&quot;</span>: <span class="string">&quot;book.test method&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="多对多关系字段"><a href="#多对多关系字段" class="headerlink" title="多对多关系字段"></a>多对多关系字段</h3><ul>
<li><strong>SerializerMethodField</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">	...</span><br><span class="line">    authors = serializers.SerializerMethodField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_authors</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="comment"># obj: book对象</span></span><br><span class="line">        authors = obj.authors.<span class="built_in">all</span>()  <span class="comment"># 跨表拿出所有作者</span></span><br><span class="line">        <span class="keyword">return</span> [&#123;<span class="string">&#x27;name&#x27;</span>: author.name, <span class="string">&#x27;age&#x27;</span>: author.age&#125; <span class="keyword">for</span> author <span class="keyword">in</span> authors]</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">serializer通过字段取出多对多关系表数据：</span></span><br><span class="line"><span class="string">  SerializerMethodField(method_name=None)</span></span><br><span class="line"><span class="string">  这是一个只读字段 它通过在附加的序列化器类上调用一个方法来获取其值 它可以用于将任何类型的数据添加到对象的序列化表示中</span></span><br><span class="line"><span class="string">  该字段会绑定一个方法 如果没有指定method_name  则默认为：get_&lt;field_name&gt;(self, obj): pass</span></span><br><span class="line"><span class="string">  该方法返回什么 序列化的字段就显示什么内容</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>输出示例</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;红楼梦&quot;</span>,</span><br><span class="line">    <span class="string">&quot;price&quot;</span>: <span class="string">&quot;123.45&quot;</span>,</span><br><span class="line">    <span class="string">&quot;publish_date&quot;</span>: <span class="string">&quot;2021-01-05T20:43:26Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;publish&quot;</span>: <span class="string">&quot;南京出版社&quot;</span>,</span><br><span class="line">    <span class="string">&quot;authors&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;minho&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>: <span class="number">25</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kimi&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>: <span class="number">46</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="请求与响应"><a href="#请求与响应" class="headerlink" title="请求与响应"></a>请求与响应</h1><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP">MDN HTTP教程</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/3.1/ref/request-response/">django request-response</a></p>
<h2 id="Request-1"><a href="#Request-1" class="headerlink" title="Request"></a>Request</h2><p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/requests/">drf-request</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/python3/python3-assert.html">assert断言 补充</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Rqeust类并没有继承django的</span></span><br><span class="line"><span class="comment"># CBV源码有部分解析</span></span><br><span class="line"><span class="comment"># 位置：from rest_framework.request import Request</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Request部分关键源码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Wrapper allowing to enhance a standard `HttpRequest` instance.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Kwargs:</span></span><br><span class="line"><span class="string">        - request(HttpRequest). The original request instance.</span></span><br><span class="line"><span class="string">        - parsers(list/tuple). The parsers to use for parsing the</span></span><br><span class="line"><span class="string">          request content.</span></span><br><span class="line"><span class="string">        - authenticators(list/tuple). The authenticators used to try</span></span><br><span class="line"><span class="string">          authenticating the request&#x27;s user.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, request, parsers=<span class="literal">None</span>, authenticators=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 negotiator=<span class="literal">None</span>, parser_context=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">isinstance</span>(request, HttpRequest), (</span><br><span class="line">            <span class="string">&#x27;The `request` argument must be an instance of &#x27;</span></span><br><span class="line">            <span class="string">&#x27;`django.http.HttpRequest`, not `&#123;&#125;.&#123;&#125;`.&#x27;</span></span><br><span class="line">            .<span class="built_in">format</span>(request.__class__.__module__, request.__class__.__name__)</span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># 赋值django封装的request</span></span><br><span class="line">        self._request = request</span><br><span class="line">      </span><br><span class="line">    <span class="comment"># 获取属性处理</span></span><br><span class="line">    <span class="comment"># 如果自己没有的 问django原生封装的request要 这个时候是self._request</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span>(<span class="params">self, attr</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        If an attribute does not exist on this instance, then we also attempt</span></span><br><span class="line"><span class="string">        to proxy it to the underlying HttpRequest object.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">getattr</span>(self._request, attr)</span><br><span class="line">        <span class="keyword">except</span> AttributeError:</span><br><span class="line">            <span class="keyword">return</span> self.__getattribute__(attr)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># request.data</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> _hasattr(self, <span class="string">&#x27;_full_data&#x27;</span>):</span><br><span class="line">            self._load_data_and_files()</span><br><span class="line">        <span class="keyword">return</span> self._full_data</span><br><span class="line">        </span><br><span class="line"><span class="comment"># __getattribute__</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span>(<span class="params">self, *args, **kwargs</span>):</span> <span class="comment"># real signature unknown</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Return getattr(self, name). &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="request-data"><a href="#request-data" class="headerlink" title="request.data"></a><strong>request.data</strong></h3><p><strong>取POST请求数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">请求对象.data -&gt; request.data</span><br><span class="line">前端以三种编码方式传入的数据 都可以取出来(结果可能是QueryDict 或 字典)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">实现：</span></span><br><span class="line"><span class="string">  from/urlencode 直接去取django原生封装的request取</span></span><br><span class="line"><span class="string">  json 去request.boby取出来 然后反序列化返回字典</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  json模块是否支持反序列化bytes格式</span></span><br><span class="line"><span class="string">    3.6以后才支持 否则要decode成字符串在反序列化</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>django原生request(request.POST)</th>
<th>drf封装后的Request对象(request.data)</th>
</tr>
</thead>
<tbody><tr>
<td>form</td>
<td>有数据 QueryDict</td>
<td>有数据 QueryDict</td>
</tr>
<tr>
<td>urlencoded</td>
<td>有数据 QueryDict</td>
<td>有数据 QueryDict</td>
</tr>
<tr>
<td>json</td>
<td>无数据</td>
<td>有数据 普通字典</td>
</tr>
</tbody></table>
<h3 id="requset-query-params"><a href="#requset-query-params" class="headerlink" title="requset.query_params"></a><strong>requset.query_params</strong></h3><p><strong>取GET请求url中的数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># drf Request类方法</span></span><br><span class="line"><span class="comment"># self._request.GET = request.query_params</span></span><br><span class="line"><span class="comment"># django原来取： request.GET</span></span><br><span class="line"><span class="comment"># drf取： request.query_params</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_params</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> self._request.GET</span><br></pre></td></tr></table></figure>
<h2 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Response 是一个类</span><br><span class="line">要使用 就要实例化(需要传参)</span><br><span class="line"></span><br><span class="line">Response(data=<span class="literal">None</span>, status=<span class="literal">None</span>, template_name=<span class="literal">None</span>, </span><br><span class="line">         headers=<span class="literal">None</span>, exception=<span class="literal">False</span>, conetnt_type=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/responses/">drf-response</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 位置：from rest_framework.response import Response</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span>(<span class="params">SimpleTemplateResponse</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    An HttpResponse that allows its data to be rendered into</span></span><br><span class="line"><span class="string">    arbitrary media types.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 实例化参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, data=<span class="literal">None</span>, status=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 template_name=<span class="literal">None</span>, headers=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 exception=<span class="literal">False</span>, content_type=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        data: 响应数据 序列化器.data返回的字典 or 自定义返回字典内容</span></span><br><span class="line"><span class="string">        status: 响应状态码</span></span><br><span class="line"><span class="string">        template_name: drf默认提供的模板 可以修改(自定制)</span></span><br><span class="line"><span class="string">        headers: 响应头</span></span><br><span class="line"><span class="string">        exception: 异常处理</span></span><br><span class="line"><span class="string">        content_type: 响应中 Content-Type标头告诉客户端实际返回的内容的内容类型</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  RESTframework提供了一个响应类Response 使用该类构造响应对象时 响应的具体数据内容会被转换(render渲染)成符合前端需求的类型</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  RESTframework提供了Renderer渲染器 用来根据请求头中的Accept(用户代理期望的MIME类型列表)来自动转换响应数据到对应格式 如果前端请求中未进行Accept声明 则会采用默认方式处理响应数据 我们可以通过配置来修改默认响应格式</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>从修改默认响应渲染类看drf配置解析顺序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以在rest_framework.settings查找所有的drf默认配置项</span></span><br><span class="line">DEFAULTS = &#123;</span><br><span class="line">    <span class="comment"># Base API policies</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [  <span class="comment"># 默认响应渲染类</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,  <span class="comment"># json渲染器</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,  <span class="comment"># 浏览API渲染器</span></span><br><span class="line">    ]</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">默认：浏览器响应成浏览器的格式 postman响应成json格式 - 通过配置实现</span></span><br><span class="line"><span class="string">可以修改：</span></span><br><span class="line"><span class="string">  1. 局部使用 - 对某个视图类有效</span></span><br><span class="line"><span class="string">  2. 全局使用 - 对全部视图类有效</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">注意：drf有默认的配置文件 即rest_framework.settings </span><br><span class="line">找的时候 先从项目的settings.py中找 -&gt; 找不到采用自己默认的</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局：django项目settings.py配置</span></span><br><span class="line">REST_FRAMEWORK = &#123;  </span><br><span class="line">    <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>, <span class="comment"># 使浏览器访问也返回json数据</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部：视图函数中修改(类属性)</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.renderers <span class="keyword">import</span> JSONRenderer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment"># 局部对视图类做配置(类属性)</span></span><br><span class="line">    renderer_classes = [<span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;ok&#x27;</span>&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 总结：drf的配置信息查找顺序(源码：面向对象属性解析顺序)</span></span><br><span class="line">先从自己类中找类属性配置 </span><br><span class="line">-&gt; django项目的settings.py中的REST_FRAMEWORK = [] 命名空间配置</span><br><span class="line">-&gt; drf自己的默认配置 rest_framework.settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># django也有两套配置文件</span></span><br><span class="line"><span class="comment"># settings.py | django.conf.global_settings.py</span></span><br><span class="line">思考：两套配置问价 如何 实现顺序的查找</span><br><span class="line">     - 类的继承可以实现 但是django这里不是 它是单个的模块</span><br><span class="line">     - django的实现：一个配置字典 先读取老的&#123;key:value&#125; 再读取新的&#123;key:value&#125;</span><br><span class="line">       字典特性：key不重复 新的key的value会覆盖老的</span><br></pre></td></tr></table></figure>
<h3 id="构造方式"><a href="#构造方式" class="headerlink" title="构造方式"></a>构造方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        print(request)</span><br><span class="line">        <span class="comment"># 返回用了默认templates渲染 如果使用浏览器访问 需要注册rest_framework</span></span><br><span class="line">        <span class="comment"># 否则浏览器会访问api.html 提示: TemplateDoesNotExist</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;minho&#x27;</span>&#125;,</span><br><span class="line">                        status=<span class="number">201</span>,</span><br><span class="line">                        headers=&#123;<span class="string">&#x27;token&#x27;</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP 201 Created</span><br><span class="line">Allow: GET, HEAD, OPTIONS</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Vary: Accept</span><br><span class="line">token: xxx</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;minho&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>常用属性</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> Response().data</span><br><span class="line">传给response对象的序列化后 但尚未render处理的数据</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> Response.status_code</span><br><span class="line">状态码的数字</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> Response.content</span><br><span class="line">经过render处理后的响应数据</span><br></pre></td></tr></table></figure>
<h3 id="响应data"><a href="#响应data" class="headerlink" title="响应data"></a>响应data</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">响应内容：</span></span><br><span class="line"><span class="string">  data就是你要返回的数据 是一个字典</span></span><br><span class="line"><span class="string">  可以是Serializer序列化后的字典 也可以是自定义的字典</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="响应status"><a href="#响应status" class="headerlink" title="响应status"></a>响应status</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">响应状态码： </span></span><br><span class="line"><span class="string">  直接使用status定义的状态码 默认返回 200 OK</span></span><br><span class="line"><span class="string">  它把所有使用到的状态码都定义成了常量 将数字对应了更明确的标识符</span></span><br><span class="line"><span class="string">  return Response(&#123;&#x27;name&#x27;: &#x27;minho&#x27;&#125;,</span></span><br><span class="line"><span class="string">                  status=status.HTTP_200_OK,</span></span><br><span class="line"><span class="string">                  headers=&#123;&#x27;token&#x27;: &#x27;xxx&#x27;&#125;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"></span><br><span class="line"><span class="comment"># status模块内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_informational</span>(<span class="params">code</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span> &lt;= code &lt;= <span class="number">199</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_success</span>(<span class="params">code</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span> &lt;= code &lt;= <span class="number">299</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_redirect</span>(<span class="params">code</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">300</span> &lt;= code &lt;= <span class="number">399</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_client_error</span>(<span class="params">code</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">400</span> &lt;= code &lt;= <span class="number">499</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_server_error</span>(<span class="params">code</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">500</span> &lt;= code &lt;= <span class="number">599</span></span><br><span class="line"></span><br><span class="line">HTTP_100_CONTINUE = <span class="number">100</span></span><br><span class="line">HTTP_101_SWITCHING_PROTOCOLS = <span class="number">101</span></span><br><span class="line">HTTP_200_OK = <span class="number">200</span></span><br><span class="line">HTTP_201_CREATED = <span class="number">201</span></span><br><span class="line">HTTP_202_ACCEPTED = <span class="number">202</span></span><br><span class="line">HTTP_203_NON_AUTHORITATIVE_INFORMATION = <span class="number">203</span></span><br><span class="line">HTTP_204_NO_CONTENT = <span class="number">204</span></span><br><span class="line">HTTP_205_RESET_CONTENT = <span class="number">205</span></span><br><span class="line">HTTP_206_PARTIAL_CONTENT = <span class="number">206</span></span><br><span class="line">HTTP_207_MULTI_STATUS = <span class="number">207</span></span><br><span class="line">HTTP_208_ALREADY_REPORTED = <span class="number">208</span></span><br><span class="line">HTTP_226_IM_USED = <span class="number">226</span></span><br><span class="line">HTTP_300_MULTIPLE_CHOICES = <span class="number">300</span></span><br><span class="line">HTTP_301_MOVED_PERMANENTLY = <span class="number">301</span></span><br><span class="line">HTTP_302_FOUND = <span class="number">302</span></span><br><span class="line">HTTP_303_SEE_OTHER = <span class="number">303</span></span><br><span class="line">HTTP_304_NOT_MODIFIED = <span class="number">304</span></span><br><span class="line">HTTP_305_USE_PROXY = <span class="number">305</span></span><br><span class="line">HTTP_306_RESERVED = <span class="number">306</span></span><br><span class="line">HTTP_307_TEMPORARY_REDIRECT = <span class="number">307</span></span><br><span class="line">HTTP_308_PERMANENT_REDIRECT = <span class="number">308</span></span><br><span class="line">HTTP_400_BAD_REQUEST = <span class="number">400</span></span><br><span class="line">HTTP_401_UNAUTHORIZED = <span class="number">401</span></span><br><span class="line">HTTP_402_PAYMENT_REQUIRED = <span class="number">402</span></span><br><span class="line">HTTP_403_FORBIDDEN = <span class="number">403</span></span><br><span class="line">HTTP_404_NOT_FOUND = <span class="number">404</span></span><br><span class="line">HTTP_405_METHOD_NOT_ALLOWED = <span class="number">405</span></span><br><span class="line">HTTP_406_NOT_ACCEPTABLE = <span class="number">406</span></span><br><span class="line">HTTP_407_PROXY_AUTHENTICATION_REQUIRED = <span class="number">407</span></span><br><span class="line">HTTP_408_REQUEST_TIMEOUT = <span class="number">408</span></span><br><span class="line">HTTP_409_CONFLICT = <span class="number">409</span></span><br><span class="line">HTTP_410_GONE = <span class="number">410</span></span><br><span class="line">HTTP_411_LENGTH_REQUIRED = <span class="number">411</span></span><br><span class="line">HTTP_412_PRECONDITION_FAILED = <span class="number">412</span></span><br><span class="line">HTTP_413_REQUEST_ENTITY_TOO_LARGE = <span class="number">413</span></span><br><span class="line">HTTP_414_REQUEST_URI_TOO_LONG = <span class="number">414</span></span><br><span class="line">HTTP_415_UNSUPPORTED_MEDIA_TYPE = <span class="number">415</span></span><br><span class="line">HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE = <span class="number">416</span></span><br><span class="line">HTTP_417_EXPECTATION_FAILED = <span class="number">417</span></span><br><span class="line">HTTP_418_IM_A_TEAPOT = <span class="number">418</span></span><br><span class="line">HTTP_422_UNPROCESSABLE_ENTITY = <span class="number">422</span></span><br><span class="line">HTTP_423_LOCKED = <span class="number">423</span></span><br><span class="line">HTTP_424_FAILED_DEPENDENCY = <span class="number">424</span></span><br><span class="line">HTTP_426_UPGRADE_REQUIRED = <span class="number">426</span></span><br><span class="line">HTTP_428_PRECONDITION_REQUIRED = <span class="number">428</span></span><br><span class="line">HTTP_429_TOO_MANY_REQUESTS = <span class="number">429</span></span><br><span class="line">HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE = <span class="number">431</span></span><br><span class="line">HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS = <span class="number">451</span></span><br><span class="line">HTTP_500_INTERNAL_SERVER_ERROR = <span class="number">500</span></span><br><span class="line">HTTP_501_NOT_IMPLEMENTED = <span class="number">501</span></span><br><span class="line">HTTP_502_BAD_GATEWAY = <span class="number">502</span></span><br><span class="line">HTTP_503_SERVICE_UNAVAILABLE = <span class="number">503</span></span><br><span class="line">HTTP_504_GATEWAY_TIMEOUT = <span class="number">504</span></span><br><span class="line">HTTP_505_HTTP_VERSION_NOT_SUPPORTED = <span class="number">505</span></span><br><span class="line">HTTP_506_VARIANT_ALSO_NEGOTIATES = <span class="number">506</span></span><br><span class="line">HTTP_507_INSUFFICIENT_STORAGE = <span class="number">507</span></span><br><span class="line">HTTP_508_LOOP_DETECTED = <span class="number">508</span></span><br><span class="line">HTTP_509_BANDWIDTH_LIMIT_EXCEEDED = <span class="number">509</span></span><br><span class="line">HTTP_510_NOT_EXTENDED = <span class="number">510</span></span><br><span class="line">HTTP_511_NETWORK_AUTHENTICATION_REQUIRED = <span class="number">511</span></span><br></pre></td></tr></table></figure>
<h3 id="响应template-name"><a href="#响应template-name" class="headerlink" title="响应template_name"></a>响应template_name</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">响应模板名：</span></span><br><span class="line"><span class="string">  指定渲染的模板名字 可以自定义模板 基本用不到 了解即可</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="响应headers"><a href="#响应headers" class="headerlink" title="响应headers"></a>响应headers</h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers">MDN HTTP消息头详解</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">响应头：</span></span><br><span class="line"><span class="string">  可以往响应头放东西 就是一个字典 具体headers字段及含义 参考上面链接  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Django设置头字段</span></span><br><span class="line"><span class="comment"># 要设置或删除响应中的头字段 请像对待字典一样对待它</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = HttpResponse()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response[<span class="string">&#x27;Age&#x27;</span>] = <span class="number">120</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> response[<span class="string">&#x27;Age&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h3 id="响应content-type"><a href="#响应content-type" class="headerlink" title="响应content_type"></a>响应content_type</h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type">MDN Content-Type </a></p>
<p><a target="_blank" rel="noopener" href="https://www.iana.org/assignments/media-types/media-types.xhtml">Media Types</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">响应编码格式：</span></span><br><span class="line"><span class="string">  请求也有 实体头部用于指示资源的MIME类型 media type</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="视图家族"><a href="#视图家族" class="headerlink" title="视图家族"></a>视图家族</h1><h2 id="两个视图基类"><a href="#两个视图基类" class="headerlink" title="两个视图基类"></a>两个视图基类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">APIView         <span class="comment"># 继承django View</span></span><br><span class="line"></span><br><span class="line">GenericAPIView  <span class="comment"># 继承drf APIVIew 做了一些扩展 重要的如下 看源码重点关注</span></span><br><span class="line">  类属性：</span><br><span class="line">    - queryset = <span class="literal">None</span></span><br><span class="line">    - serializer_class = <span class="literal">None</span></span><br><span class="line">  类方法：</span><br><span class="line">    - get_queryset()   常用</span><br><span class="line">    - get_object()     获取一条数据</span><br><span class="line">    - get_serializer() 常用</span><br><span class="line">    - get_setrializer_class() 内部来用 外部会重写(视图类中用到多个序列化器的时候)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get_object()源码解析</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericAPIView</span>(<span class="params">views.APIView</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Returns the object the view is displaying.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        You may want to override this if you need to provide non-standard</span></span><br><span class="line"><span class="string">        queryset lookups.  Eg if objects are referenced using multiple</span></span><br><span class="line"><span class="string">        keyword arguments in the url conf.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 返回所有数据queryset对象 会有过滤</span></span><br><span class="line">        queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Perform the lookup filtering.</span></span><br><span class="line">        <span class="comment"># lookup_field = &#x27;pk&#x27;  </span></span><br><span class="line">        <span class="comment"># lookup_url_kwarg = None</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        url路径 对应有名分组的名字 默认叫 pk 不对应则报错</span></span><br><span class="line"><span class="string">        如果需要修改：在自己的视图类 重写定义上面两个字段的其中一个</span></span><br><span class="line"><span class="string">        这里的lookup_url_kwarg 就是pk(默认) </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        lookup_url_kwarg = self.lookup_url_kwarg <span class="keyword">or</span> self.lookup_field</span><br><span class="line">		</span><br><span class="line">        <span class="comment"># &#123;pk: 4&#125; url有名分组 -&gt; 关键字传参到对应的视图函数</span></span><br><span class="line">        filter_kwargs = &#123;self.lookup_field: self.kwargs[lookup_url_kwarg]&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 根据pk=4 去queryset对象中get单个对象</span></span><br><span class="line">        obj = get_object_or_404(queryset, **filter_kwargs)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># May raise a permission denied</span></span><br><span class="line">        self.check_object_permissions(self.request, obj)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure>
<h3 id="APIView-1"><a href="#APIView-1" class="headerlink" title="APIView"></a>APIView</h3><ul>
<li><strong>继承APIView实现5个常用接口</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前面视图类继承APIView写CBV 已经能比较快速的写出5个常用接口</span></span><br><span class="line"><span class="comment"># CBV代码如下：</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksDetail</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取一个数据&quot;&quot;&quot;</span></span><br><span class="line">        book = Book.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        serializer = BookSerializer(instance=book)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;修改一个数据&quot;&quot;&quot;</span></span><br><span class="line">        book = Book.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        serializer = BookSerializer(book, request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            serializer.save()</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;删除一个数据&quot;&quot;&quot;</span></span><br><span class="line">        Book.objects.<span class="built_in">filter</span>(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksList</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取数据列表(所有数据)&quot;&quot;&quot;</span></span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer = BookSerializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;新增一个数据&quot;&quot;&quot;</span></span><br><span class="line">        serializer = BookSerializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            serializer.save()</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br></pre></td></tr></table></figure>
<h3 id="GenericAPIVIew"><a href="#GenericAPIVIew" class="headerlink" title="GenericAPIVIew"></a>GenericAPIVIew</h3><ul>
<li><strong>源码分析</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericAPIView</span>(<span class="params">views.APIView</span>):</span></span><br><span class="line">    queryset = <span class="literal">None</span></span><br><span class="line">    serializer_class = <span class="literal">None</span></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> self.queryset <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, (</span><br><span class="line">            <span class="string">&quot;&#x27;%s&#x27; should either include a `queryset` attribute, &quot;</span></span><br><span class="line">            <span class="string">&quot;or override the `get_queryset()` method.&quot;</span></span><br><span class="line">            % self.__class__.__name__</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        queryset = self.queryset</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(queryset, QuerySet):</span><br><span class="line">            <span class="comment"># Ensure queryset is re-evaluated on each request.</span></span><br><span class="line">            queryset = queryset.<span class="built_in">all</span>()</span><br><span class="line">        <span class="keyword">return</span> queryset    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">看GenericAPIView源码发现 继承该类 需要覆盖2个类属性：</span></span><br><span class="line"><span class="string">  - queryset -&gt; QuertSet对象 - 指定使用哪个模型</span></span><br><span class="line"><span class="string">  - serializer_class -&gt; 序列化器 - 指定使用哪个序列化器来序列化上面模型类对应的数据</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">看get_queryset(self)方法知道 queryset可以写两种写法</span></span><br><span class="line"><span class="string">  - queryset = Book.object.all()</span></span><br><span class="line"><span class="string">  - queryset = Book.object  # 源码会自己判断</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>继承GenericView实现上面APIView的接口功能</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">基于GenericAPIView实现上面5个接口 其实非常简单</span></span><br><span class="line"><span class="string">通过源码我们发现下面规律</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>功能描述</th>
<th>APIView</th>
<th>GenericView</th>
</tr>
</thead>
<tbody><tr>
<td>获取所有数据</td>
<td><code>books = Book.objects.all()</code></td>
<td><code>books = self.get_queryset()</code></td>
</tr>
<tr>
<td>获取单个数据</td>
<td><code>book = Book.objects.filter(pk=pk).first()</code></td>
<td><code>book = self.get_object()</code></td>
</tr>
<tr>
<td>序列化所有数据</td>
<td><code>serializer = BookSerializer(instance=books, many=True)</code></td>
<td><code>serializer = self.get_serializer(instance=books, many=True)</code></td>
</tr>
<tr>
<td>序列化单个数据</td>
<td><code>serializer = BookSerializer(instance=book)</code></td>
<td><code>serializer = self.get_serializer(instance=book)</code></td>
</tr>
<tr>
<td>反序列化单个数据</td>
<td><code>serializer = BookSerializer(data=request.data)</code></td>
<td><code>serializer = self.get_serializer(data=request.data)</code></td>
</tr>
<tr>
<td>删除数据</td>
<td><code>Book.objects.filter(pk=pk).delete()</code></td>
<td><code>self.get_object().delete()</code></td>
</tr>
</tbody></table>
</li>
</ul>
<p><strong>发现以上规律后 使用GenericView重写上面5个接口则非常简单</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksDetail</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        book = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance=book)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        book = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(book, request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            serializer.save()</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        self.get_object().delete()</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksList</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        books = self.get_queryset()</span><br><span class="line">        serializer = self.get_serializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            serializer.save()</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line">  </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">继承GenericView重写这5个接口之后 有什么优势?</span></span><br><span class="line"><span class="string">  我们只要把具体方法里面的之前表达业务字段的变量(book/books) 替换成 通用的没有具体含义的变量(如：obj)</span></span><br><span class="line"><span class="string">  视图函数的代码实现就变得非常通用</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如何通用?</span></span><br><span class="line"><span class="string">  我们需要序列化其他模型类里面的数据的时候 只需要完成下面三步即可完成CBV视图函数的代码编写</span></span><br><span class="line"><span class="string">  1. 赋值粘贴代码</span></span><br><span class="line"><span class="string">  2. 修改CBV类名(如：BookList -&gt; UserList)</span></span><br><span class="line"><span class="string">  3. 重写赋值 queryset 和 serializer_class 两个类属性</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">问题：</span><br><span class="line">  这一步写完之后 虽然比较法方便 但是你会发现具体方法的代码既然都一样(冗余度大) </span><br><span class="line">  每次都要拷贝同样的代码 只是替换不同的数据模型以及对应模型的序列化器</span><br><span class="line">  那我们如果把这些方法通用的代码都封装为不同的Mixin类 然后CBV视图直接使用多继承的方式 岂不是更加方便和简介</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">drf提供了5个视图扩展Mixin类 封装了上面的通用功能</span></span><br><span class="line"><span class="string">后面使用 只需要多继承这些Mixin类 即可使用其封装好的方法</span></span><br><span class="line"><span class="string">  - 序列化所有数据 返回Response  self.list</span></span><br><span class="line"><span class="string">  - 序列化单个数据 返回Response  self.retrieve</span></span><br><span class="line"><span class="string">  - 反序列化一个数据(新增) 返回Response  self.create</span></span><br><span class="line"><span class="string">  - 反序列化一个数据(修改) 返回Response  self.update</span></span><br><span class="line"><span class="string">  - 删除一个数据 返回Response  self.destroy</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="五个视图扩展Mixin类"><a href="#五个视图扩展Mixin类" class="headerlink" title="五个视图扩展Mixin类"></a>五个视图扩展Mixin类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<h3 id="ListModelMixin"><a href="#ListModelMixin" class="headerlink" title="ListModelMixin"></a>ListModelMixin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListModelMixin</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    List a queryset.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">        page = self.paginate_queryset(queryset)</span><br><span class="line">        <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> self.get_paginated_response(serializer.data)</span><br><span class="line"></span><br><span class="line">        serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>
<h3 id="CreateModelMixin"><a href="#CreateModelMixin" class="headerlink" title="CreateModelMixin"></a>CreateModelMixin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateModelMixin</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Create a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        self.perform_create(serializer)</span><br><span class="line">        headers = self.get_success_headers(serializer.data)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_create</span>(<span class="params">self, serializer</span>):</span></span><br><span class="line">        serializer.save()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_success_headers</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&#x27;Location&#x27;</span>: <span class="built_in">str</span>(data[api_settings.URL_FIELD_NAME])&#125;</span><br><span class="line">        <span class="keyword">except</span> (TypeError, KeyError):</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="RetrieveModelMixin"><a href="#RetrieveModelMixin" class="headerlink" title="RetrieveModelMixin"></a>RetrieveModelMixin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RetrieveModelMixin</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Retrieve a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retrieve</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>
<h3 id="UpdateModelMixin"><a href="#UpdateModelMixin" class="headerlink" title="UpdateModelMixin"></a>UpdateModelMixin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateModelMixin</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Update a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        partial = kwargs.pop(<span class="string">&#x27;partial&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance, data=request.data, partial=partial)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        self.perform_update(serializer)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">getattr</span>(instance, <span class="string">&#x27;_prefetched_objects_cache&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">            <span class="comment"># If &#x27;prefetch_related&#x27; has been applied to a queryset, we need to</span></span><br><span class="line">            <span class="comment"># forcibly invalidate the prefetch cache on the instance.</span></span><br><span class="line">            instance._prefetched_objects_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_update</span>(<span class="params">self, serializer</span>):</span></span><br><span class="line">        serializer.save()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partial_update</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        kwargs[<span class="string">&#x27;partial&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="DestroyModelMixin"><a href="#DestroyModelMixin" class="headerlink" title="DestroyModelMixin"></a>DestroyModelMixin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DestroyModelMixin</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Destroy a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">destroy</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        self.perform_destroy(instance)</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_destroy</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        instance.delete()</span><br></pre></td></tr></table></figure>
<h3 id="Mixin类使用"><a href="#Mixin类使用" class="headerlink" title="Mixin类使用"></a>Mixin类使用</h3><p><strong>基于GenericAPIView和5个Mixin类重写书籍管理接口</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> CreateModelMixin, ListModelMixin</span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> DestroyModelMixin, RetrieveModelMixin, UpdateModelMixin</span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksDetail</span>(<span class="params">RetrieveModelMixin, UpdateModelMixin, DestroyModelMixin, GenericAPIView</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, pk)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, pk)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, pk)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksList</span>(<span class="params">ListModelMixin, CreateModelMixin, GenericAPIView</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.create(request)</span><br></pre></td></tr></table></figure>
<h2 id="九个通用视图子类"><a href="#九个通用视图子类" class="headerlink" title="九个通用视图子类"></a>九个通用视图子类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">上面使用多继承 继承对应方法的Mixin类和GenericView类重写几个接口 已经非常简介优雅</span></span><br><span class="line"><span class="string">drf还提供了更方便的继承方法(drf自己完成对应的Mixin和GenericView的继承 你只需要按需继承drf提供的新的类即可)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<h3 id="CreateAPIView"><a href="#CreateAPIView" class="headerlink" title="CreateAPIView"></a>CreateAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增一个对象 POST</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateAPIView</span>(<span class="params">mixins.CreateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                    GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for creating a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.create(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="ListAPIView"><a href="#ListAPIView" class="headerlink" title="ListAPIView"></a>ListAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回所有对象 GET</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListAPIView</span>(<span class="params">mixins.ListModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                  GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for listing a queryset.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="RetrieveAPIView"><a href="#RetrieveAPIView" class="headerlink" title="RetrieveAPIView"></a>RetrieveAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回一个对象 GET  retrieve: 取回</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RetrieveAPIView</span>(<span class="params">mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                      GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for retrieving a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="DestroyAPIView"><a href="#DestroyAPIView" class="headerlink" title="DestroyAPIView"></a>DestroyAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除一个对象 DELETE</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DestroyAPIView</span>(<span class="params">mixins.DestroyModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                     GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for deleting a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="UpdateAPIView"><a href="#UpdateAPIView" class="headerlink" title="UpdateAPIView"></a>UpdateAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新一个对象 PUT/PATCH</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateAPIView</span>(<span class="params">mixins.UpdateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                    GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for updating a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">patch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.partial_update(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="ListCreateAPIView"><a href="#ListCreateAPIView" class="headerlink" title="ListCreateAPIView"></a>ListCreateAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># List 返回所有对象|新增一个对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListCreateAPIView</span>(<span class="params">mixins.ListModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                        mixins.CreateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                        GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for listing a queryset or creating a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.create(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="RetrieveUpdateAPIView"><a href="#RetrieveUpdateAPIView" class="headerlink" title="RetrieveUpdateAPIView"></a>RetrieveUpdateAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 限制删除单个对象 返回一个对象|更新一个对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RetrieveUpdateAPIView</span>(<span class="params">mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                            mixins.UpdateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                            GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for retrieving, updating a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">patch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.partial_update(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="RetrieveDestroyAPIView"><a href="#RetrieveDestroyAPIView" class="headerlink" title="RetrieveDestroyAPIView"></a>RetrieveDestroyAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 限制更新单个对象 返回一个对象|删除一个对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RetrieveDestroyAPIView</span>(<span class="params">mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                             mixins.DestroyModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                             GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for retrieving or deleting a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="RetrieveUpdateDestroyAPIView"><a href="#RetrieveUpdateDestroyAPIView" class="headerlink" title="RetrieveUpdateDestroyAPIView"></a>RetrieveUpdateDestroyAPIView</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Detail 返回一个对象|更新一个对象|删除一个对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RetrieveUpdateDestroyAPIView</span>(<span class="params">mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                                   mixins.UpdateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                                   mixins.DestroyModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                                   GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Concrete view for retrieving, updating or deleting a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">patch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.partial_update(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="通用视图子类使用"><a href="#通用视图子类使用" class="headerlink" title="通用视图子类使用"></a>通用视图子类使用</h3><p><strong>根据接口需求继承这9个视图子类重写接口</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">这9个视图子类 都继承于GenericAPIView 然后根据不同的接口需求混入实现不同功能的Mixin类 并且实现对应的 get/post/put/patch/delete 方法 我们只需要根据我们接口需求 继承上面这9个视图子类的其中一个或几个即可 </span></span><br><span class="line"><span class="string">然后仅仅只需提供GenericAPIView视图需要的 queryset 和 serializer_class 两个类属性即可十分简洁的完成接口的书写</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用9个视图子类中的其中2个重写5个书籍管理接口</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> ListCreateAPIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> RetrieveUpdateDestroyAPIView</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksDetail</span>(<span class="params">RetrieveUpdateDestroyAPIView</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksList</span>(<span class="params">ListCreateAPIView</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">-&gt; 发起请求 </span></span><br><span class="line"><span class="string">-&gt; 路由匹配 </span></span><br><span class="line"><span class="string">-&gt; CBV视图函数 </span></span><br><span class="line"><span class="string">-&gt; as_view()执行返回view函数地址</span></span><br><span class="line"><span class="string">-&gt; view函数执行dispath方法 完成请求分发 </span></span><br><span class="line"><span class="string">-&gt; dispath方法把此次请求的方法名转换为小写(request.method -&gt; GET -&gt; get -&gt; getattr(self, get))</span></span><br><span class="line"><span class="string">-&gt; 通过反射getattr获取CBV视图函数的对应方法名称</span></span><br><span class="line"><span class="string">-&gt; 执行该方法</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">这个时候 我们继承的这9个视图子类 已经封装好了对应请求的方法</span></span><br><span class="line"><span class="string">根据实例属性方法的查找是顺序 比如GET请求过来(request.method = GET)：</span></span><br><span class="line"><span class="string">-&gt; 自己写的CBV视图类找对应的get方法</span></span><br><span class="line"><span class="string">-&gt; 没有找到(这个时候不用再自己提供这些方法) </span></span><br><span class="line"><span class="string">-&gt; 往父类查找</span></span><br><span class="line"><span class="string">-&gt; 最终会在这9个视图子类找到对应封装的get方法执行</span></span><br><span class="line"><span class="string">-&gt; 通用视图子类执行自己的get方法</span></span><br><span class="line"><span class="string">-&gt; 然后调用Mixin类封装的方法序列化/反序列化数据 并返回响应</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="视图集ViewSet"><a href="#视图集ViewSet" class="headerlink" title="视图集ViewSet"></a>视图集ViewSet</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">使用上面通用视图子类 已经非常简洁的实现了5个接口</span></span><br><span class="line"><span class="string">但是我们使用了2个CBV 而且对应的类属性都是一样的(queryset和serializer_calss)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我们是否可以直接合成一个?</span></span><br><span class="line"><span class="string">问题：合成一个的问题在于 这两个CBV分别都有一个get方法</span></span><br><span class="line"><span class="string">     - 一个get 是获取所有数据</span></span><br><span class="line"><span class="string">     - 另一个get 是获取单个数据</span></span><br><span class="line"><span class="string">如果能解决这个问题 那么就可以合并</span></span><br><span class="line"><span class="string">如何解决?</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="ModelViewSet"><a href="#ModelViewSet" class="headerlink" title="ModelViewSet"></a>ModelViewSet</h3><p><strong>使用ModelViewSet编写5个接口 需要注意路由的变化</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">注意路由变化 使用ViewSet actions参数必须传入</span></span><br><span class="line"><span class="string">简单看下源码发现 此时的as_view方法 已经被ViewSetMixin类重写 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">解决同一个get请求需要对应执行不同方法的问题</span></span><br><span class="line"><span class="string">  - 获取所有数据 &#123;&#x27;get&#x27;: &#x27;list&#x27;&#125;</span></span><br><span class="line"><span class="string">  - 获取单个数据 &#123;&#x27;get&#x27;: &#x27;retrieve&#x27;&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 使用ViewSet actions参数必须传 是一个字典 &#123;请求小写: 执行的方法名&#125;</span></span><br><span class="line">    <span class="comment"># 当路径匹配上 并且是get请求 会执行BookModelViewSet类的list方法 其余同理</span></span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, views.BookModelViewSet.as_view(actions=&#123;<span class="string">&#x27;get&#x27;</span>: <span class="string">&#x27;list&#x27;</span>, <span class="string">&#x27;post&#x27;</span>: <span class="string">&#x27;create&#x27;</span>&#125;)),</span><br><span class="line">    path(<span class="string">&#x27;books/&lt;int:pk&gt;/&#x27;</span>, views.BookModelViewSet.as_view(actions=&#123;<span class="string">&#x27;get&#x27;</span>: <span class="string">&#x27;retrieve&#x27;</span>, <span class="string">&#x27;put&#x27;</span>: <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>: <span class="string">&#x27;destroy&#x27;</span>&#125;)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;合并BookList CBV 和BookDetail CBV&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br></pre></td></tr></table></figure>
<h3 id="ViewSetMixin源码分析"><a href="#ViewSetMixin源码分析" class="headerlink" title="ViewSetMixin源码分析"></a>ViewSetMixin源码分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ViewSetMixin重写了as_view方法 核心代码</span></span><br><span class="line"><span class="string">只要路由中配置了对应关系 比如 &#123;&#x27;get&#x27;: &#x27;list&#x27;, &#x27;post&#x27;: &#x27;create&#x27;&#125;</span></span><br><span class="line"><span class="string">当get请求过来 就会执行对象的list方法</span></span><br><span class="line"><span class="string">当post请求过来 就会执行对象的create方法</span></span><br><span class="line"><span class="string">  通过反射实现 把扩展Mixin类的 list create方法 拿过来赋值给当前ViewSet对象</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewSetMixin</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This is the magic.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Overrides `.as_view()` so that it takes an `actions` keyword that performs</span></span><br><span class="line"><span class="string">    the binding of HTTP methods to actions on the Resource.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    For example, to create a concrete view binding the &#x27;GET&#x27; and &#x27;POST&#x27; methods</span></span><br><span class="line"><span class="string">    to the &#x27;list&#x27; and &#x27;create&#x27; actions...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    view = MyViewSet.as_view(&#123;&#x27;get&#x27;: &#x27;list&#x27;, &#x27;post&#x27;: &#x27;create&#x27;&#125;)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classonlymethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">as_view</span>(<span class="params">cls, actions=<span class="literal">None</span>, **initkwargs</span>):</span></span><br><span class="line">		...</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">view</span>(<span class="params">request, *args, **kwargs</span>):</span></span><br><span class="line">            self = cls(**initkwargs)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;get&#x27;</span> <span class="keyword">in</span> actions <span class="keyword">and</span> <span class="string">&#x27;head&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> actions:</span><br><span class="line">                actions[<span class="string">&#x27;head&#x27;</span>] = actions[<span class="string">&#x27;get&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># &#123;&#x27;get&#x27;: &#x27;list&#x27;, &#x27;post&#x27;: &#x27;create&#x27;&#125;</span></span><br><span class="line">            self.action_map = actions</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Bind methods to actions</span></span><br><span class="line">            <span class="comment"># This is the bit that&#x27;s different to a standard view</span></span><br><span class="line">            <span class="keyword">for</span> method, action <span class="keyword">in</span> actions.items():</span><br><span class="line">                <span class="comment"># method: get | action: list</span></span><br><span class="line">                <span class="comment"># 反射获取属性：执行完handler赋值 handler就变成了list(Mixin类写好的)的内存地址</span></span><br><span class="line">                handler = <span class="built_in">getattr</span>(self, action)</span><br><span class="line">                <span class="comment"># 反射设置属性：当前视图对象.get = list </span></span><br><span class="line">                <span class="comment"># 当get请求过来 CBV经过dispath分发 触发视图函数的.get方法</span></span><br><span class="line">                <span class="built_in">setattr</span>(self, method, handler)</span><br><span class="line">                <span class="comment"># for循环执行完毕 对象.get -&gt; list 对象.post -&gt; create</span></span><br><span class="line"></span><br><span class="line">            self.request = request</span><br><span class="line">            self.args = args</span><br><span class="line">            self.kwargs = kwargs</span><br><span class="line"></span><br><span class="line">            <span class="comment"># And continue as usual</span></span><br><span class="line">            <span class="keyword">return</span> self.dispatch(request, *args, **kwargs)</span><br><span class="line">		...</span><br><span class="line">        <span class="keyword">return</span> csrf_exempt(view)</span><br></pre></td></tr></table></figure>
<h3 id="继承ViewSetMixin的视图类"><a href="#继承ViewSetMixin的视图类" class="headerlink" title="继承ViewSetMixin的视图类"></a>继承ViewSetMixin的视图类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">通过上面源码的分析 我们知道使用ViewSet的时候 as_view需要一个actions参数</span></span><br><span class="line"><span class="string">它会将请求方法(key)与你指定的执行函数(value)绑定</span></span><br><span class="line"><span class="string">那么 继承ViewSetMixin的视图类 我们就可以改写路由 以及改写CBV提供的get/post等的方法名称</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">总结：继承ViewSetMixin视图类 配置好actions参数的映射关系 CBV方法名称可以任意</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, views.BookModelViewSet.as_view(actions=&#123;<span class="string">&#x27;get&#x27;</span>: <span class="string">&#x27;get_all_book&#x27;</span>&#125;))</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ViewSetMixin一定要放在APIView前面 </span></span><br><span class="line"><span class="comment"># 多继承属性查找顺序 让as_view方法先找ViewSetMixin的</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookModelViewSet</span>(<span class="params">ViewSetMixin, APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_all_book</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer = BookSerializer(books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># drf内置提供了这些继承ViewSetMixin视图类的子类</span></span><br></pre></td></tr></table></figure>
<h4 id="ViewSet"><a href="#ViewSet" class="headerlink" title="ViewSet"></a>ViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 继承APIview 就是上一步我们实现的</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewSet</span>(<span class="params">ViewSetMixin, views.APIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The base ViewSet class does not provide any actions by default.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h4 id="GenericViewSet"><a href="#GenericViewSet" class="headerlink" title="GenericViewSet"></a>GenericViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 继承GenericView 可以使用GenericView的各种方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericViewSet</span>(<span class="params">ViewSetMixin, generics.GenericAPIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The GenericViewSet class does not provide any actions by default,</span></span><br><span class="line"><span class="string">    but does include the base set of generic view behavior, such as</span></span><br><span class="line"><span class="string">    the `get_object` and `get_queryset` methods.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h4 id="ReadOnlyModelViewSet"><a href="#ReadOnlyModelViewSet" class="headerlink" title="ReadOnlyModelViewSet"></a>ReadOnlyModelViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只读视图集 只提供获取所有数据 和获取单个数据的方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadOnlyModelViewSet</span>(<span class="params">mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                           mixins.ListModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                           GenericViewSet</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    A viewset that provides default `list()` and `retrieve()` actions.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h4 id="ModelViewSet-1"><a href="#ModelViewSet-1" class="headerlink" title="ModelViewSet"></a>ModelViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前面使用的ModelViewSet 提供了5个接口的实现方法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">get    -  list/retrieve</span></span><br><span class="line"><span class="string">post   -  create</span></span><br><span class="line"><span class="string">put    -  update</span></span><br><span class="line"><span class="string">patch  -  partial_update</span></span><br><span class="line"><span class="string">delete -  destroy</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelViewSet</span>(<span class="params">mixins.CreateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                   mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                   mixins.UpdateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                   mixins.DestroyModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                   mixins.ListModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                   GenericViewSet</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    A viewset that provides default `create()`, `retrieve()`, `update()`,</span></span><br><span class="line"><span class="string">    `partial_update()`, `destroy()` and `list()` actions.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h1 id="路由Routers"><a href="#路由Routers" class="headerlink" title="路由Routers"></a>路由Routers</h1><h2 id="简单写法"><a href="#简单写法" class="headerlink" title="简单写法"></a>简单写法</h2><p><strong>在urls.py中配置</strong></p>
<h3 id="FBV"><a href="#FBV" class="headerlink" title="FBV"></a><strong>FBV</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&#x27;publishs/&lt;int:pk&gt;/&#x27;</span>, views.detail)</span><br></pre></td></tr></table></figure>
<h3 id="CBV"><a href="#CBV" class="headerlink" title="CBV"></a><strong>CBV</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&#x27;publishs/&lt;int:pk&gt;/&#x27;</span>, views.PublishDetail.as_view())</span><br></pre></td></tr></table></figure>
<h3 id="ViewSetMixin"><a href="#ViewSetMixin" class="headerlink" title="ViewSetMixin"></a>ViewSetMixin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一旦视图类继承ViewSetMixin之后 写法稍有不同</span></span><br><span class="line"><span class="comment"># as_view() 必须传入actions参数(位置或关键字传参)</span></span><br><span class="line"><span class="comment"># ViewSetMixin重写as_view 比如get：通过反射取&#x27;list&#x27;函数 赋值给&#x27;get&#x27;</span></span><br><span class="line">path(<span class="string">&#x27;books/&#x27;</span>, views.BookViewSet.as_view(actions=&#123;<span class="string">&#x27;get&#x27;</span>: <span class="string">&#x27;list&#x27;</span>, <span class="string">&#x27;post&#x27;</span>: <span class="string">&#x27;create&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure>
<h2 id="Routers"><a href="#Routers" class="headerlink" title="Routers"></a>Routers</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 继承自ModelViewSet的路由Routers写法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 导入routers模块</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 该模块有两个类 实例化得到对象</span></span><br><span class="line"><span class="comment"># routers.DefaultRouter() -&gt; 生成的路由更多</span></span><br><span class="line"><span class="comment"># routers.SimpleRouter() -&gt; 生成两条路由</span></span><br><span class="line"><span class="comment"># router = routers.SimpleRouter()</span></span><br><span class="line">router = routers.DefaultRouter()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 注册</span></span><br><span class="line"><span class="comment"># prefix: 路由前缀 不要加斜杠</span></span><br><span class="line"><span class="comment"># viewset: 继承自ModelViewSet的视图类</span></span><br><span class="line"><span class="comment"># basename: 别名 reverse反向解析使用</span></span><br><span class="line"><span class="comment"># router.register(prefix, viewset, basename=None)</span></span><br><span class="line">router.register(<span class="string">&#x27;books&#x27;</span>, views.BookViewSet)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 将router.urls自动生成的路由加到原路由中</span></span><br><span class="line">urlpatterns += router.urls</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="SimpleRouter和DefaultRouter"><a href="#SimpleRouter和DefaultRouter" class="headerlink" title="SimpleRouter和DefaultRouter"></a>SimpleRouter和DefaultRouter</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;SimpleRouter 自动生成2条路由&quot;&quot;&quot;</span></span><br><span class="line">&lt;URLPattern <span class="string">&#x27;^books/$&#x27;</span> [name=<span class="string">&#x27;book-list&#x27;</span>]&gt;,</span><br><span class="line">&lt;URLPattern <span class="string">&#x27;^books/(?P&lt;pk&gt;[^/.]+)/$&#x27;</span> [name=<span class="string">&#x27;book-detail&#x27;</span>]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;DefaultRouter 自动生成6条路由&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 这两条跟SimpleRouter一样</span></span><br><span class="line">&lt;URLPattern <span class="string">&#x27;^books/$&#x27;</span> [name=<span class="string">&#x27;book-list&#x27;</span>]&gt;, </span><br><span class="line">&lt;URLPattern <span class="string">&#x27;^books/(?P&lt;pk&gt;[^/.]+)/$&#x27;</span> [name=<span class="string">&#x27;book-detail&#x27;</span>]&gt;, </span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面两条有名分组：format关键字传参</span></span><br><span class="line">&lt;URLPattern <span class="string">&#x27;^books\.(?P&lt;format&gt;[a-z0-9]+)/?$&#x27;</span> [name=<span class="string">&#x27;book-list&#x27;</span>]&gt;,  <span class="comment"># http://127.0.0.1:8000/books.json</span></span><br><span class="line">&lt;URLPattern <span class="string">&#x27;^books/(?P&lt;pk&gt;[^/.]+)\.(?P&lt;format&gt;[a-z0-9]+)/?$&#x27;</span> [name=<span class="string">&#x27;book-detail&#x27;</span>]&gt;,  <span class="comment"># http://127.0.0.1:8000/books/5.json</span></span><br><span class="line"></span><br><span class="line">&lt;URLPattern <span class="string">&#x27;^$&#x27;</span> [name=<span class="string">&#x27;api-root&#x27;</span>]&gt;,   <span class="comment"># 根路径会显示出所有可以访问的地址</span></span><br><span class="line">&lt;URLPattern <span class="string">&#x27;^\.(?P&lt;format&gt;[a-z0-9]+)/?$&#x27;</span> [name=<span class="string">&#x27;api-root&#x27;</span>]&gt;  <span class="comment"># http://127.0.0.1:8000/books/books.api|.json</span></span><br></pre></td></tr></table></figure>
<h2 id="action使用"><a href="#action使用" class="headerlink" title="action使用"></a>action使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 作用：为了给继承自ModelViewSet的视图类中定义的函数也添加路由</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何使用?</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> action</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    action是一个带参装饰器</span></span><br><span class="line"><span class="string">    参数：methods -&gt; 是一个列表 列表中放请求方式 methods=[&#x27;GET&#x27;, &#x27;POST&#x27;]</span></span><br><span class="line"><span class="string">    参数：detail -&gt; 布尔类型 True/False 是否带pk</span></span><br><span class="line"><span class="string">      - True: ^books/(?P&lt;pk&gt;[^/.]+)/get_one/$ 生成带pk的地址</span></span><br><span class="line"><span class="string">      - False: ^books/get_one/ 生成不带pk的地址</span></span><br><span class="line"><span class="string">    当朝生成的地址发送methods里面支持的请求 会执行下面的函数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>], detail=<span class="literal">True</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_one</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">        print(pk)</span><br><span class="line">        <span class="comment"># 截取1条</span></span><br><span class="line">        book = self.get_queryset()[:<span class="number">2</span>]</span><br><span class="line">        <span class="comment"># 虽然只取1条 但是结果仍然是可迭代对象 不是单个对象 仍需设置many=True</span></span><br><span class="line">        serializer = self.get_serializer(book, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>
<h1 id="认证组件"><a href="#认证组件" class="headerlink" title="认证组件"></a>认证组件</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="权限组件"><a href="#权限组件" class="headerlink" title="权限组件"></a>权限组件</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="频率组件"><a href="#频率组件" class="headerlink" title="频率组件"></a>频率组件</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="分页器-响应器"><a href="#分页器-响应器" class="headerlink" title="分页器 响应器"></a>分页器 响应器</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="url控制器-版本控制"><a href="#url控制器-版本控制" class="headerlink" title="url控制器 版本控制"></a>url控制器 版本控制</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Kathr1neMinho</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://github.com/kathr1ne/2021/02/22/DjangoRestFramework/">https://github.com/kathr1ne/2021/02/22/DjangoRestFramework/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://github.com/kathr1ne" target="_blank">Kathr1neMinho</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/">前后端分离</a><a class="post-meta__tags" href="/tags/RESTful/">RESTful</a><a class="post-meta__tags" href="/tags/API/">API</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2021/02/10/Django/"><img class="next-cover" src="/img/django.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Django</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/02/10/Django/" title="Django"><img class="cover" src="/img/django.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-10</div><div class="title">Django</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.JPG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Kathr1neMinho</div><div class="author-info__description">学习笔记</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div></div><a class="button--animated" id="card-info-btn" href="https://github.com/kathr1ne"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/kathr1ne" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/97431110@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RESTFramework"><span class="toc-number">1.</span> <span class="toc-text">RESTFramework</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RESTful-API"><span class="toc-number">1.1.</span> <span class="toc-text">RESTful API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">1.1.2.</span> <span class="toc-text">规范</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DRF%E5%88%9D%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">DRF初识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">简单使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CBV%E6%BA%90%E7%A0%81"><span class="toc-number">2.3.</span> <span class="toc-text">CBV源码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#View"><span class="toc-number">2.3.1.</span> <span class="toc-text">View</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#APIView"><span class="toc-number">2.3.2.</span> <span class="toc-text">APIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Request"><span class="toc-number">2.3.3.</span> <span class="toc-text">Request</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">序列化器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.1.</span> <span class="toc-text">查询一个数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.1.2.</span> <span class="toc-text">字段类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.3.</span> <span class="toc-text">字段参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.2.</span> <span class="toc-text">反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">3.2.1.</span> <span class="toc-text">修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.2.</span> <span class="toc-text">数据校验钩子函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E6%AE%B5%E5%A4%84%E7%90%86"><span class="toc-number">3.2.3.</span> <span class="toc-text">序列化反序列化字段处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BD%99API%E6%93%8D%E4%BD%9C"><span class="toc-number">3.3.</span> <span class="toc-text">其余API操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.1.</span> <span class="toc-text">查询所有数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.2.</span> <span class="toc-text">新增数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.3.</span> <span class="toc-text">删除数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94%E5%86%85%E5%AE%B9"><span class="toc-number">3.4.</span> <span class="toc-text">自定义响应内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E7%B1%BB%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number">3.5.</span> <span class="toc-text">模型类序列化器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#many-True%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">3.6.</span> <span class="toc-text">many&#x3D;True源码分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Serializer%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="toc-number">3.7.</span> <span class="toc-text">Serializer高级用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5"><span class="toc-number">3.7.1.</span> <span class="toc-text">一对多关系字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5"><span class="toc-number">3.7.2.</span> <span class="toc-text">多对多关系字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94"><span class="toc-number">4.</span> <span class="toc-text">请求与响应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Request-1"><span class="toc-number">4.1.</span> <span class="toc-text">Request</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#request-data"><span class="toc-number">4.1.1.</span> <span class="toc-text">request.data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#requset-query-params"><span class="toc-number">4.1.2.</span> <span class="toc-text">requset.query_params</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Response"><span class="toc-number">4.2.</span> <span class="toc-text">Response</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E5%BC%8F"><span class="toc-number">4.2.1.</span> <span class="toc-text">构造方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94data"><span class="toc-number">4.2.2.</span> <span class="toc-text">响应data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94status"><span class="toc-number">4.2.3.</span> <span class="toc-text">响应status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94template-name"><span class="toc-number">4.2.4.</span> <span class="toc-text">响应template_name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94headers"><span class="toc-number">4.2.5.</span> <span class="toc-text">响应headers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94content-type"><span class="toc-number">4.2.6.</span> <span class="toc-text">响应content_type</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%AE%B6%E6%97%8F"><span class="toc-number">5.</span> <span class="toc-text">视图家族</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%B1%BB"><span class="toc-number">5.1.</span> <span class="toc-text">两个视图基类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#APIView-1"><span class="toc-number">5.1.1.</span> <span class="toc-text">APIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GenericAPIVIew"><span class="toc-number">5.1.2.</span> <span class="toc-text">GenericAPIVIew</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E4%B8%AA%E8%A7%86%E5%9B%BE%E6%89%A9%E5%B1%95Mixin%E7%B1%BB"><span class="toc-number">5.2.</span> <span class="toc-text">五个视图扩展Mixin类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ListModelMixin"><span class="toc-number">5.2.1.</span> <span class="toc-text">ListModelMixin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CreateModelMixin"><span class="toc-number">5.2.2.</span> <span class="toc-text">CreateModelMixin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RetrieveModelMixin"><span class="toc-number">5.2.3.</span> <span class="toc-text">RetrieveModelMixin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UpdateModelMixin"><span class="toc-number">5.2.4.</span> <span class="toc-text">UpdateModelMixin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DestroyModelMixin"><span class="toc-number">5.2.5.</span> <span class="toc-text">DestroyModelMixin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mixin%E7%B1%BB%E4%BD%BF%E7%94%A8"><span class="toc-number">5.2.6.</span> <span class="toc-text">Mixin类使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E4%B8%AA%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE%E5%AD%90%E7%B1%BB"><span class="toc-number">5.3.</span> <span class="toc-text">九个通用视图子类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CreateAPIView"><span class="toc-number">5.3.1.</span> <span class="toc-text">CreateAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListAPIView"><span class="toc-number">5.3.2.</span> <span class="toc-text">ListAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RetrieveAPIView"><span class="toc-number">5.3.3.</span> <span class="toc-text">RetrieveAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DestroyAPIView"><span class="toc-number">5.3.4.</span> <span class="toc-text">DestroyAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UpdateAPIView"><span class="toc-number">5.3.5.</span> <span class="toc-text">UpdateAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListCreateAPIView"><span class="toc-number">5.3.6.</span> <span class="toc-text">ListCreateAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RetrieveUpdateAPIView"><span class="toc-number">5.3.7.</span> <span class="toc-text">RetrieveUpdateAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RetrieveDestroyAPIView"><span class="toc-number">5.3.8.</span> <span class="toc-text">RetrieveDestroyAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RetrieveUpdateDestroyAPIView"><span class="toc-number">5.3.9.</span> <span class="toc-text">RetrieveUpdateDestroyAPIView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE%E5%AD%90%E7%B1%BB%E4%BD%BF%E7%94%A8"><span class="toc-number">5.3.10.</span> <span class="toc-text">通用视图子类使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E9%9B%86ViewSet"><span class="toc-number">5.4.</span> <span class="toc-text">视图集ViewSet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ModelViewSet"><span class="toc-number">5.4.1.</span> <span class="toc-text">ModelViewSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewSetMixin%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">5.4.2.</span> <span class="toc-text">ViewSetMixin源码分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BFViewSetMixin%E7%9A%84%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">5.4.3.</span> <span class="toc-text">继承ViewSetMixin的视图类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ViewSet"><span class="toc-number">5.4.3.1.</span> <span class="toc-text">ViewSet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GenericViewSet"><span class="toc-number">5.4.3.2.</span> <span class="toc-text">GenericViewSet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReadOnlyModelViewSet"><span class="toc-number">5.4.3.3.</span> <span class="toc-text">ReadOnlyModelViewSet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ModelViewSet-1"><span class="toc-number">5.4.3.4.</span> <span class="toc-text">ModelViewSet</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1Routers"><span class="toc-number">6.</span> <span class="toc-text">路由Routers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%86%99%E6%B3%95"><span class="toc-number">6.1.</span> <span class="toc-text">简单写法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FBV"><span class="toc-number">6.1.1.</span> <span class="toc-text">FBV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CBV"><span class="toc-number">6.1.2.</span> <span class="toc-text">CBV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewSetMixin"><span class="toc-number">6.1.3.</span> <span class="toc-text">ViewSetMixin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Routers"><span class="toc-number">6.2.</span> <span class="toc-text">Routers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleRouter%E5%92%8CDefaultRouter"><span class="toc-number">6.2.1.</span> <span class="toc-text">SimpleRouter和DefaultRouter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#action%E4%BD%BF%E7%94%A8"><span class="toc-number">6.3.</span> <span class="toc-text">action使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E7%BB%84%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">认证组件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%84%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">权限组件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%91%E7%8E%87%E7%BB%84%E4%BB%B6"><span class="toc-number">9.</span> <span class="toc-text">频率组件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%99%A8-%E5%93%8D%E5%BA%94%E5%99%A8"><span class="toc-number">10.</span> <span class="toc-text">分页器 响应器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#url%E6%8E%A7%E5%88%B6%E5%99%A8-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">11.</span> <span class="toc-text">url控制器 版本控制</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/02/22/DjangoRestFramework/" title="DjangoRESTframework"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DjangoRESTframework"/></a><div class="content"><a class="title" href="/2021/02/22/DjangoRestFramework/" title="DjangoRESTframework">DjangoRESTframework</a><time datetime="2021-02-22T15:00:00.000Z" title="发表于 2021-02-22 23:00:00">2021-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/02/10/Django/" title="Django"><img src="/img/django.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Django"/></a><div class="content"><a class="title" href="/2021/02/10/Django/" title="Django">Django</a><time datetime="2021-02-10T14:00:00.000Z" title="发表于 2021-02-10 22:00:00">2021-02-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Kathr1neMinho</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>